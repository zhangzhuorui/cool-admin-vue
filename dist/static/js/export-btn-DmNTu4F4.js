import{u as e,d as t}from"./comm-D8jqGG-6.js";import{d as r}from"./dayjs@1.11.13-DxKHiy_y.js";import{F as o}from"./file-saver@2.0.5-CkG_H5jq.js";import{u as s,w as i}from"./xlsx@0.18.5-DF0p_WFv.js";import{v as n}from"./index-D3YIdvZh.js";import{v as a,A as p}from"./lodash-es@4.17.21-DuLBTDIG.js";import{E as l}from"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import{d as c,m,A as u}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{u as f}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{v as d}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import"./@vue_runtime-dom@3.5.18-D95plCo_.js";import"./@vue_shared@3.5.18-BWKBh1Qo.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import"./element-plus@2.10.4_vue@3.5.18_typescript@5.5.4_-BKZsM6nW.js";import"./normalize-wheel-es@1.2.0-TzhA1irr.js";import"./@vueuse_core@9.13.0_vue@3.5.18_typescript@5.5.4_-CQVfZnDR.js";import"./@vueuse_shared@9.13.0_vue@3.5.18_typescript@5.5.4_-DyKSiD-b.js";import"./@ctrl_tinycolor@3.6.1-D2oWfImC.js";import"./chardet@2.1.0-B0E1a5C9.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-CyTP3PVf.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-B6jvMh_s.js";import"./store@2.0.12-BfN7CKDu.js";import"./mitt@3.0.1-BeZB7Ik_.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.18_typescript@5.5.4_-DPB-daMN.js";import"./vue-router@4.5.1_vue@3.5.18_typescript@5.5.4_-LCN95BWb.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.18_echarts@5.6.0_vue@3.5.18_typescript@5.5.4_-He2CYVXX.js";import"./echarts@5.6.0-D5a_RdwN.js";import"./tslib@2.3.0-ZseNXxlj.js";import"./zrender@5.6.1-BkMfNy7l.js";import"./axios@1.11.0-C-1G2k3o.js";import"./nprogress@0.2.0-Sg3Wh2FH.js";import"./@sxzz_popperjs-es@2.11.7-CT_jBSb5.js";import"./async-validator@4.2.5-j0i5Y79Y.js";import"./memoize-one@6.0.0-BAtLgO95.js";import"./@floating-ui_dom@1.7.2-CHufsicy.js";import"./@floating-ui_core@1.7.2-DWnBSKmT.js";import"./@floating-ui_utils@0.2.10-QZXVpxRV.js";import"./@intlify_core-base@11.1.10-C1bgUhoS.js";import"./@intlify_shared@11.1.10-BEv--mwN.js";import"./@intlify_message-compiler@11.1.10-JI08Nz38.js";function h(){if(!(this instanceof h))return new h;this.SheetNames=[],this.Sheets={}}function _(e){const t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let o=0;o!=e.length;++o)r[o]=255&e.charCodeAt(o);return t}function v({multiHeader:e=[],header:t=[],data:r=[],filename:n="",merges:a=[],autoWidth:p=!0,bookType:l="xlsx"}={}){n=n||"excel-list",(r=[...r]).unshift(t);for(let o=e.length-1;o>-1;o--)r.unshift(e[o]);const c="SheetJS",m=new h,u=function(e){const t={},r={s:{c:1e7,r:1e7},e:{c:0,r:0}};for(let o=0;o!=e.length;++o)for(let i=0;i!=e[o].length;++i){r.s.r>o&&(r.s.r=o),r.s.c>i&&(r.s.c=i),r.e.r<o&&(r.e.r=o),r.e.c<i&&(r.e.c=i);const n={v:e[o][i]};if(null==n.v)continue;const a=s.encode_cell({c:i,r:o});n.t="s",t[a]=n}return r.s.c<1e7&&(t["!ref"]=s.encode_range(r)),t}(r);if(a.length>0&&(u["!merges"]||(u["!merges"]=[]),a.forEach(e=>{u["!merges"].push(s.decode_range(e))})),p){const e=r.map(e=>e.map(e=>null==e?{wch:10}:e.toString().charCodeAt(0)>255?{wch:2*e.toString().length}:{wch:e.toString().length})),t=e[0];for(let r=1;r<e.length;r++)for(let o=0;o<e[r].length;o++)t[o].wch<e[r][o].wch&&(t[o].wch=e[r][o].wch);u["!cols"]=t}m.SheetNames.push(c),m.Sheets[c]=u;const f=i(m,{bookType:l,bookSST:!1,type:"binary"});o.saveAs(new Blob([_(f)],{type:"application/octet-stream"}),`${n}.${l}`)}const j=c({name:"cl-export-btn",props:{filename:[Function,String],autoWidth:{type:Boolean,default:!0},bookType:{type:String,default:"xlsx"},header:Array,columns:{type:Array},data:[Function,Array],maxExportLimit:Number},setup(o,{slots:s}){const{t:i}=f(),c=e(),h=t(),_=d(!1);async function j(e){_.value=!0;const t=e.map(e=>e.prop).filter(Boolean),s=await async function(e,t){return e.filter(e=>!e.hidden&&t.includes(e.prop)).map(e=>e.label)}(e,t);let a=await async function(){var e,t,r;const s={...null==(e=c.value)?void 0:e.paramsReplace(c.value.params),maxExportLimit:o.maxExportLimit,isExport:!0};return"function"==typeof o.data?o.data(s):o.data?o.data:(null==(t=c.value)?void 0:t.service)?null==(r=c.value)?void 0:r.service.page(s).then(e=>e.list.map((e,t)=>{var r,s;for(const i in e){const a=null==(r=o.columns)?void 0:r.find(e=>e.prop==i);a&&(a.formatter&&(e[i]=a.formatter(e,a,e[i],t)),a.dict&&(e[i]=(null==(s=n(e[i],a.dict))?void 0:s.label)||e[i]))}return e})).catch(e=>(l.error(e.message),[])):[]}();if(!a)return _.value=!1,l.error(i("导出数据异常"));const p=await async function(){return"function"==typeof o.filename?await(null==o?void 0:o.filename()):o.filename||`Doc（${r().format("YYYY-MM-DD HH_mm_ss")}）`}();a=a.map(e=>t.map(t=>e[t])),v({header:s,data:a,filename:p,autoWidth:o.autoWidth,bookType:o.bookType}),_.value=!1}function y(){var e;if(!o.columns)return;const t=a(o.columns,"orderNum","asc").filter(e=>!(!0===e.hidden||["selection","expand","index","op"].includes(e.type)||e.filterExport||e["filter-export"]));null==(e=h.value)||e.open({title:i("导出"),width:"600px",props:{labelPosition:"top"},form:{checked:t.map(e=>e.prop)},items:[{label:i("选择列"),prop:"checked",component:{name:"el-checkbox-group",options:t.map(e=>({label:String(e.label),value:e.prop}))}}],on:{submit(e,{close:r,done:o}){p(e.checked)?(l.warning(i("请先选择要导出的列")),o()):(j(t.filter(t=>e.checked.includes(t.prop))),r())}}})}return()=>m(u("el-button"),{loading:_.value,onClick:y},{default:()=>[s.default?s.default():i("导出"),m(u("cl-form"),{ref:h},null)]})}});export{j as default};
