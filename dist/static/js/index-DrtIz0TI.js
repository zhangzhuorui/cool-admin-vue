import{d as e,u as o,c as l,e as t}from"./comm-D8jqGG-6.js";import{u as r,d as a,i as n,c as s,P as p}from"./index-D3YIdvZh.js";import"./store@2.0.12-BfN7CKDu.js";import{E as i}from"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import{v as u,A as m}from"./lodash-es@4.17.21-DuLBTDIG.js";import{d,A as c,c as h,o as f,m as v,O as y,R as b,F as _,v as w,e as j,N as g,P as x,a0 as k}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{u as V}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{v as U,y as C,u as I}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import{P as A}from"./@vue_shared@3.5.18-BWKBh1Qo.js";import{d as T}from"./dayjs@1.11.13-DxKHiy_y.js";import{A as F,u as R}from"./dev-VfV6_aPV.js";import{_ as E}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./@vue_runtime-dom@3.5.18-D95plCo_.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import"./element-plus@2.10.4_vue@3.5.18_typescript@5.5.4_-BKZsM6nW.js";import"./normalize-wheel-es@1.2.0-TzhA1irr.js";import"./@vueuse_core@9.13.0_vue@3.5.18_typescript@5.5.4_-CQVfZnDR.js";import"./@vueuse_shared@9.13.0_vue@3.5.18_typescript@5.5.4_-DyKSiD-b.js";import"./@ctrl_tinycolor@3.6.1-D2oWfImC.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-CyTP3PVf.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-B6jvMh_s.js";import"./mitt@3.0.1-BeZB7Ik_.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.18_typescript@5.5.4_-DPB-daMN.js";import"./vue-router@4.5.1_vue@3.5.18_typescript@5.5.4_-LCN95BWb.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.18_echarts@5.6.0_vue@3.5.18_typescript@5.5.4_-He2CYVXX.js";import"./echarts@5.6.0-D5a_RdwN.js";import"./tslib@2.3.0-ZseNXxlj.js";import"./zrender@5.6.1-BkMfNy7l.js";import"./axios@1.11.0-C-1G2k3o.js";import"./nprogress@0.2.0-Sg3Wh2FH.js";import"./chardet@2.1.0-B0E1a5C9.js";import"./@sxzz_popperjs-es@2.11.7-CT_jBSb5.js";import"./async-validator@4.2.5-j0i5Y79Y.js";import"./memoize-one@6.0.0-BAtLgO95.js";import"./@floating-ui_dom@1.7.2-CHufsicy.js";import"./@floating-ui_core@1.7.2-DWnBSKmT.js";import"./@floating-ui_utils@0.2.10-QZXVpxRV.js";import"./@intlify_core-base@11.1.10-C1bgUhoS.js";import"./@intlify_shared@11.1.10-BEv--mwN.js";import"./@intlify_message-compiler@11.1.10-JI08Nz38.js";const N=d({name:"undefined"}),S=d({...N,name:"menu-imp",setup(l){const{t:t}=V(),{service:a}=r(),n=e(),s=o(),p=U(!1);function m(e,o){p.value=!0;const l=new FileReader;l.onload=e=>{var l,r;p.value=!1;try{const o=JSON.parse(null==(l=e.target)?void 0:l.result);null==(r=n.value)||r.open({title:t("菜单导入"),height:"400px",width:"600px",props:{labelWidth:"0px"},op:{saveButtonText:t("添加")},items:[{component:{name:"slot-tips"}},{component:{name:"el-tree",props:{data:u(o,"orderNum","asc"),nodeKey:"name",props:{label:"name",children:"childMenus"},renderContent:(e,{data:o})=>o.name},style:{padding:"5px",borderRadius:"var(--el-border-radius-base)",border:"1px solid var(--el-border-color)"}}}],on:{submit(e,{close:l,done:r}){a.base.sys.menu.import({menus:o}).then(()=>{var e;i.success(t("导入成功")),null==(e=s.value)||e.refresh(),l()}).catch(e=>{i.error(e.message),r()})}}})}catch(m){i.error(t("{file}文件格式错误：{error}",{file:o.name,error:m}))}},l.readAsText(o)}return(e,o)=>{const l=c("cl-svg"),t=c("el-button"),r=c("cl-upload"),a=c("el-alert"),s=c("cl-form");return f(),h(_,null,[v(r,{type:"file","show-file-list":!1,"auto-upload":!1,disabled:p.value,onUpload:m},{default:y(()=>[v(t,{type:"success",loading:p.value},{default:y(()=>[v(l,{name:"import",class:"mr-[5px]"}),b(" "+A(e.$t("导入")),1)]),_:1},8,["loading"])]),_:1},8,["disabled"]),v(s,{ref_key:"Form",ref:n},{"slot-tips":y(()=>[v(a,{type:"warning"},{default:y(()=>[b(A(e.$t("如遇到问题无法导入菜单，请检查文件并尝试重新导入。")),1)]),_:1})]),_:1},512)],64)}}}),$=d({name:"undefined"}),P=d({...$,name:"menu-exp",props:{data:{type:Array,default:()=>[]}},setup(o){const{t:l}=V(),t=o,{service:a,refs:n,setRefs:s}=r(),p=e();function u(){var e;null==(e=p.value)||e.open({title:l("导出"),width:"600px",props:{labelPosition:"top"},op:{saveButtonText:l("导出")},items:[{label:l("选择菜单"),prop:"ids",component:{name:"el-tree-select",ref:s("ids"),props:{data:t.data,nodeKey:"id",multiple:!0,showCheckbox:!0,collapseTags:!0,collapseTagsTooltip:!0,props:{label:"name",children:"_children"}}}}],on:{submit(e,{done:o,close:t}){const r=[...n.ids.getCheckedKeys(),...n.ids.getHalfCheckedKeys()];m(r)?(i.warning(l("请先选择要导出的菜单")),o()):a.base.sys.menu.export({ids:r}).then(e=>{t();const o=new Blob([JSON.stringify(e)],{type:"application/json"}),r=URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.download=l("菜单数据")+` ${T().format("MM-DD HH_mm_ss")}.json`,a.click(),URL.revokeObjectURL(r)}).catch(e=>{i.error(e.message)})}}})}return(e,o)=>{const l=c("cl-svg"),t=c("el-button"),r=c("cl-form");return f(),h(_,null,[v(t,{type:"info",onClick:u},{default:y(()=>[v(l,{name:"export",class:"mr-[5px]"}),b(" "+A(e.$t("导出")),1)]),_:1}),v(r,{ref_key:"Form",ref:p},null,512)],64)}}}),z=d({name:"undefined"}),O=E(d({...z,name:"menu-create",setup(o){const{service:l,mitt:t,refs:s,setRefs:p}=r(),i=R(),u=e(),{t:d}=V(),k=[],U=w(()=>a(k.map(e=>e.value)));function I(){var e;s.aiCode.send("getEps"),null==(e=u.value)||e.open({title:d("快速创建"),width:"800px",items:[{prop:"entity",label:d("数据结构"),component:{name:"slot-entity"},span:8,required:!0},{prop:"parentId",label:d("上级节点"),span:16,component:{name:"cl-menu-select",props:{type:1,placeholder:d("请选择上级节点")}}},{prop:"name",label:d("菜单名称"),span:8,component:{name:"el-input",props:{placeholder:d("请输入菜单名称")}},required:!0},{prop:"router",label:d("菜单路由"),span:8,component:{name:"el-input",props:{placeholder:d("请输入菜单路由，如：/test")}},rules:{required:!0,validator(e,o,l){(o||"").startsWith("/")?l():l(new Error(d("必须以 / 开头")))}}},{prop:"orderNum",label:d("菜单排序"),span:8,value:1,component:{name:"el-input-number",props:{placeholder:d("请填写菜单排序"),min:0,max:99,"controls-position":"right"}}},{prop:"icon",label:d("菜单图标"),component:{name:"cl-menu-icon",props:{showIcon:!0,placeholder:d("请选择图标")}}},{prop:"keepAlive",value:!0,flex:!1,label:d("路由缓存"),component:{name:"cl-switch"}}],op:{saveButtonText:d("开始创建")},on:{async submit(e,{done:o,close:l}){const r=k.find(o=>o.value==e.entity.join("/"));s.aiCode.send("createVue",{...r,router:e.router},a=>{i.create({...e,module:r.module,prefix:r.prefix,api:r.api,code:a}).then(e=>{t.emit("helper.createMenu"),e(),l()}).catch(e=>{o()})})}}})}function T(e){var o,l;const t=k.find(o=>o.value==(null==e?void 0:e.join("/")));t&&(null==(o=u.value)||o.setForm("router",`/${t.value}`),null==(l=u.value)||l.setForm("module",t.module))}return j(()=>{l.base.open.eps().then(e=>{for(const o in e)e[o].forEach(e=>{m(e.columns)||k.push({value:e.prefix.substring(7),...e})})})}),(e,o)=>{const l=c("el-button"),t=c("el-cascader"),r=c("cl-form");return f(),h(_,null,[C(n)?(f(),g(l,{key:0,type:"success",onClick:I},{default:y(()=>[b(A(e.$t("快速创建")),1)]),_:1})):x("",!0),v(r,{ref_key:"Form",ref:u},{"slot-entity":y(({scope:o})=>[v(t,{modelValue:o.entity,"onUpdate:modelValue":e=>o.entity=e,filterable:"",clearable:"",separator:".",options:U.value,placeholder:e.$t("请选择数据结构"),onChange:T},null,8,["modelValue","onUpdate:modelValue","options","placeholder"])]),_:1},512),v(F,{path:"/ai",ref:C(p)("aiCode"),hide:""},null,512)],64)}}}),[["__scopeId","data-v-7637007b"]]),q=d({name:"undefined"}),M=E(d({...q,name:"auto-perms",props:{menuId:[String,Number]},emits:["open","close"],setup(o,{emit:l}){const t=o,s=l,{service:p}=r(),{t:u}=V(),m=e();async function d(){return p.base.open.eps().then(e=>{const o=[],l=[];for(const t in e)e[t].forEach(e=>{var t;e.prefix=null==(t=e.prefix)?void 0:t.replace("/admin/",""),e.prefix&&l.push(e.prefix),o.push(e)});return{prop:"entity",label:u("实体数据"),component:{name:"el-cascader",props:{options:a(l),separator:".",props:{multiple:!0},onChange(e){var l;const t=[];e.forEach(e=>{const l=o.find(o=>o.prefix==e.join("/"));l&&(l.api.forEach(e=>{e.perms=(l.prefix+e.path).replace(/\//g,":"),e.checked=!0}),t.push(l))}),null==(l=m.value)||l.setForm("list",t)}}}}})}async function w(){var e;s("open"),null==(e=m.value)||e.open({title:u("自动添加权限"),width:"800px",dialog:{draggable:!0,controls:["close"]},props:{labelPosition:"top"},op:{saveButtonText:u("一键添加")},items:[await d(),{prop:"list",label:u("权限列表"),value:[],hidden:({scope:e})=>!e.entity,component:{name:"slot-list"}}],on:{submit(e,{done:o,close:l}){if(!e.entity)return i.error(u("请选择实体数据")),void o();const r=e.list.map(e=>e.api).flat().filter(e=>e.checked);return r.find(e=>!e.summary)?(i.error(u("请填写权限名称")),void o()):0==r.length?(i.error(u("请至少选择一个权限")),void o()):void Promise.all(r.map(e=>p.base.sys.menu.add({type:2,parentId:t.menuId,name:e.summary,perms:e.perms}))).then(()=>{i.success(u("添加权限成功")),l(),s("close")}).catch(e=>{o(),i.error(e.message)})}}})}return(e,o)=>{const l=c("el-button"),t=c("el-divider"),r=c("el-switch"),a=c("el-input"),s=c("cl-menu-perms"),p=c("el-scrollbar"),i=c("cl-form");return f(),h(_,null,[C(n)?(f(),g(l,{key:0,style:{"margin-left":"10px"},onClick:w},{default:y(()=>[b(A(e.$t("自动添加")),1)]),_:1})):x("",!0),v(i,{ref_key:"Form",ref:m},{"slot-list":y(({scope:o})=>[v(p,{class:"scrollbar"},{default:y(()=>[(f(!0),h(_,null,k(o.list,(o,l)=>(f(),h("div",{key:l,class:"list"},[v(t,{"content-position":"left"},{default:y(()=>[b(A(o.prefix),1)]),_:2},1024),(f(!0),h(_,null,k(o.api,(o,l)=>(f(),h("div",{key:l,class:"item"},[v(r,{modelValue:o.checked,"onUpdate:modelValue":e=>o.checked=e},null,8,["modelValue","onUpdate:modelValue"]),v(a,{modelValue:o.summary,"onUpdate:modelValue":e=>o.summary=e,clearable:"",placeholder:e.$t("权限名称"),disabled:!o.checked},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled"]),v(s,{modelValue:o.perms,"onUpdate:modelValue":e=>o.perms=e,disabled:!o.checked},null,8,["modelValue","onUpdate:modelValue","disabled"])]))),128))]))),128))]),_:2},1024)]),_:1},512)],64)}}}),[["__scopeId","data-v-a139a190"]]),B={key:1},K={key:1},L={key:1},W=d({name:"undefined"}),D=d({...W,name:"sys-menu",setup(e){const{service:a,mitt:n}=r(),{menu:i}=s(),{t:u}=V(),m=I({type:[{label:u("目录"),value:0,type:"warning"},{label:u("菜单"),value:1,type:"success"},{label:u("权限"),value:2,type:"danger"}]}),d=l({contextMenu:[e=>({label:u("新增"),hidden:!(2!=e.type&&a.base.sys.user._permission.add),callback(o){x(e),o()}}),"update","delete",e=>({label:u("权限"),hidden:!(2!=e.type&&a.base.sys.user._permission.add),callback(o){!function({id:e}){var o;null==(o=w.value)||o.rowAppend({parentId:e,type:2})}(e),o()}})],columns:[{type:"selection"},{prop:"name",label:u("名称"),align:"left",width:200,fixed:"left"},{prop:"isShow",label:u("是否显示"),width:100},{prop:"icon",label:u("图标"),width:100},{prop:"type",label:u("类型"),width:110,dict:m.type},{prop:"router",label:u("节点路由"),minWidth:170},{prop:"keepAlive",label:u("路由缓存"),width:100},{prop:"viewPath",label:u("文件路径"),minWidth:200,showOverflowTooltip:!0},{prop:"perms",label:u("权限"),headerAlign:"center",minWidth:300,component:{name:"cl-dict"}},{prop:"orderNum",label:u("排序号"),width:100,fixed:"right",sortable:"asc"},{prop:"updateTime",label:u("更新时间"),sortable:"custom",width:170},{type:"op",width:250,buttons:({scope:e})=>[{label:u("新增"),type:"success",hidden:!(a.base.sys.menu._permission.add&&2!=e.row.type),onClick({scope:e}){x(e.row)}},"edit","delete"]}],plugins:[p.Table.toTree({lazy:!0})]}),_=t({dialog:{width:"800px"},items:[{prop:"type",value:0,label:u("节点类型"),required:!0,component:{name:"el-radio-group",options:m.type}},{prop:"name",label:u("节点名称"),component:{name:"el-input"},required:!0},{prop:"parentId",label:u("上级节点"),hook:{submit:e=>e||null},component:{name:"slot-parentId"}},{prop:"router",label:u("节点路由"),hidden:({scope:e})=>1!=e.type,component:{name:"el-input",props:{placeholder:u("请输入节点路由，如：/test")}}},{prop:"keepAlive",value:!0,label:u("路由缓存"),hidden:({scope:e})=>1!=e.type,component:{name:"el-radio-group",options:[{label:u("开启"),value:!0},{label:u("关闭"),value:!1}]}},{prop:"isShow",label:u("是否显示"),value:!0,hidden:({scope:e})=>2==e.type,flex:!1,component:{name:"el-switch"}},{prop:"viewPath",label:u("文件路径"),hidden:({scope:e})=>1!=e.type,component:{name:"cl-menu-file"}},{prop:"icon",label:u("图标"),hidden:({scope:e})=>2==e.type,component:{name:"cl-menu-icon",props:{showIcon:!0}}},{prop:"orderNum",label:u("排序号"),component:{name:"el-input-number",props:{placeholder:u("请填写排序号"),min:0,max:99,"controls-position":"right"}}},{prop:"perms",label:"权限",hidden:({scope:e})=>2!=e.type,component:{name:"slot-perms"}}],plugins:[p.Form.setFocus("name")]}),w=o({service:a.base.sys.menu,onRefresh(e,{render:o}){a.base.sys.menu.list(e).then(e=>{i.get(),o(e)})}},e=>{e.refresh({prop:"orderNum",order:"asc"})});function j(e){var o;null==(o=w.value)||o.refresh(e)}function x({type:e=0,id:o}){var l;null==(l=w.value)||l.rowAppend({parentId:o,parentType:e,type:e+1,keepAlive:!0,isShow:!0})}return n.on("helper.createMenu",j),(e,o)=>{const l=c("cl-refresh-btn"),t=c("cl-add-btn"),r=c("cl-multi-delete-btn"),a=c("cl-flex1"),n=c("cl-row"),s=c("cl-svg"),p=c("cl-switch"),i=c("el-link"),u=c("cl-table"),m=c("cl-menu-select"),x=c("cl-menu-perms"),k=c("cl-upsert"),V=c("cl-crud");return f(),g(V,{ref_key:"Crud",ref:w},{default:y(()=>[v(n,null,{default:y(()=>{var e;return[v(l),v(t),v(r),v(O),v(a),v(S),v(P,{data:null==(e=C(d))?void 0:e.data},null,8,["data"])]}),_:1}),v(n,null,{default:y(()=>[v(u,{ref_key:"Table",ref:d},{"column-icon":y(({scope:e})=>[v(s,{name:e.row.icon,size:16},null,8,["name"])]),"column-isShow":y(({scope:e})=>[2!=e.row.type?(f(),g(p,{key:0,modelValue:e.row.isShow,"onUpdate:modelValue":o=>e.row.isShow=o,scope:e.row,column:e.column},null,8,["modelValue","onUpdate:modelValue","scope","column"])):(f(),h("span",B))]),"column-keepAlive":y(({scope:e})=>[1==e.row.type?(f(),g(p,{key:0,modelValue:e.row.keepAlive,"onUpdate:modelValue":o=>e.row.keepAlive=o,scope:e.row,column:e.column},null,8,["modelValue","onUpdate:modelValue","scope","column"])):(f(),h("span",K))]),"column-router":y(({scope:e})=>[1==e.row.type?(f(),g(i,{key:0,type:"success",href:e.row.router},{default:y(()=>[b(A(e.row.router),1)]),_:2},1032,["href"])):(f(),h("span",L,A(e.row.router),1))]),_:1},512)]),_:1}),v(k,{ref_key:"Upsert",ref:_},{"slot-parentId":y(({scope:e})=>[v(m,{modelValue:e.parentId,"onUpdate:modelValue":o=>e.parentId=o,type:e.type},null,8,["modelValue","onUpdate:modelValue","type"])]),"slot-perms":y(({scope:e})=>[v(x,{modelValue:e.perms,"onUpdate:modelValue":o=>e.perms=o},null,8,["modelValue","onUpdate:modelValue"]),v(M,{"menu-id":e.parentId,onOpen:o[0]||(o[0]=e=>{var o;return null==(o=C(_))?void 0:o.close()}),onClose:o[1]||(o[1]=e=>j())},null,8,["menu-id"])]),_:1},512)]),_:1},512)}}});export{D as default};
