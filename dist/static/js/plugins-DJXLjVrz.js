import{u as e,m as l,l as s}from"./index-D3YIdvZh.js";import"./store@2.0.12-BfN7CKDu.js";import{m as t}from"./marked@14.1.4-ZPvq6_mx.js";import{d as a,B as i,v as o,o as n,x as r,z as c,I as p,D as u,A as d}from"./lodash-es@4.17.21-DuLBTDIG.js";import{E as m,a as v}from"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import{d as f,p as g,v as h,e as _,A as y,E as b,c as j,o as k,a as C,D as w,m as x,O as V,N as $,P as z,F as S,a0 as O,R as P,Q as N}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{u as U}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{u as q,m as W,y as E}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import{p as J,P as L}from"./@vue_shared@3.5.18-BWKBh1Qo.js";import{_ as T}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./@vue_runtime-dom@3.5.18-D95plCo_.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-CyTP3PVf.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-B6jvMh_s.js";import"./mitt@3.0.1-BeZB7Ik_.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.18_typescript@5.5.4_-DPB-daMN.js";import"./vue-router@4.5.1_vue@3.5.18_typescript@5.5.4_-LCN95BWb.js";import"./comm-D8jqGG-6.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import"./element-plus@2.10.4_vue@3.5.18_typescript@5.5.4_-BKZsM6nW.js";import"./dayjs@1.11.13-DxKHiy_y.js";import"./chardet@2.1.0-B0E1a5C9.js";import"./normalize-wheel-es@1.2.0-TzhA1irr.js";import"./@vueuse_core@9.13.0_vue@3.5.18_typescript@5.5.4_-CQVfZnDR.js";import"./@vueuse_shared@9.13.0_vue@3.5.18_typescript@5.5.4_-DyKSiD-b.js";import"./@ctrl_tinycolor@3.6.1-D2oWfImC.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.18_echarts@5.6.0_vue@3.5.18_typescript@5.5.4_-He2CYVXX.js";import"./echarts@5.6.0-D5a_RdwN.js";import"./tslib@2.3.0-ZseNXxlj.js";import"./zrender@5.6.1-BkMfNy7l.js";import"./axios@1.11.0-C-1G2k3o.js";import"./nprogress@0.2.0-Sg3Wh2FH.js";import"./@sxzz_popperjs-es@2.11.7-CT_jBSb5.js";import"./async-validator@4.2.5-j0i5Y79Y.js";import"./memoize-one@6.0.0-BAtLgO95.js";import"./@floating-ui_dom@1.7.2-CHufsicy.js";import"./@floating-ui_core@1.7.2-DWnBSKmT.js";import"./@floating-ui_utils@0.2.10-QZXVpxRV.js";import"./@intlify_core-base@11.1.10-C1bgUhoS.js";import"./@intlify_shared@11.1.10-BEv--mwN.js";import"./@intlify_message-compiler@11.1.10-JI08Nz38.js";const B={class:"plugins"},F={class:"plugins__header"},A={class:"plugins__container"},I={class:"item"},R={class:"item-inner is-add"},D={class:"item"},H={class:"item-inner"},M={key:0,class:"op"},G=["onClick"],K=["onClick"],Q={class:"c"},X={class:"det"},Y={class:"tag"},Z={class:"title line-clamp-1"},ee={class:"desc line-clamp-2"},le={class:"author"},se={class:"f"},te={class:"plugins__pics"},ae={class:"list"},ie=["onClick"],oe=["src"],ne={class:"op"},re={class:"flex align-center mb-[10px] select-none"},ce={class:"mr-[20px]"},pe={class:"flex align-center"},ue=f({name:"undefined"}),de=T(f({...ue,name:"helper-plugins-vue",setup(f){const{router:T,service:ue,refs:de,setRefs:me,mitt:ve}=e(),fe=l.get("helper"),{t:ge}=U(),{install:he}=s(),_e=q({active:"installed",p:"",list:[{label:ge("已安装"),value:"installed"},{label:ge("全部插件"),value:"shop"},{label:ge("插件开发"),value:"dev"}],change(e){_e.active=e},onChange(e){"dev"==e?(_e.active=_e.p||"installed",g(()=>{window.open("https://cool-js.com/plugin/create")})):(_e.p=e,be.refresh())}}),ye=h(()=>"installed"==_e.active),be=q({installed:[],shop:[],data:null,init(){be.refresh(),ve.off("plugin.refresh"),ve.on("plugin.refresh",()=>{_e.change("installed"),be.refresh()})},remove(e,l){v.confirm(ge("确定要卸载插件【{name}】吗？",{name:e.name}),ge("提示"),{type:"warning"}).then(()=>{ue.plugin.info.delete({ids:[e.id]}).then(()=>{be.installed.splice(l,1),m.success(ge("卸载成功"))}).catch(e=>{m.error(e.message)})}).catch(()=>null)},async doc(e){e.readme?(be.data=e,de.editorPreview.open(await t.parse(e.readme))):e.doc&&window.open(e.doc)},onEnable(e){e.isVue?ue.request({url:"/__cool_updatePlugin",method:"POST",data:{name:e.name,data:e.config,enable:1==e.status},proxy:!1}):ue.plugin.info.update({id:e.id,status:e.status?1:0}).then(()=>{m.success(e.status?ge("启用成功"):ge("禁用成功"))}).catch(e=>{m.error(e.message)})},keyWord:"",params:{page:1,size:24,isMy:!1},loaded:!1,loading:!1,async refresh(e){if("shop"==_e.active){i(be.params,e||{});const l={keyWord:be.keyWord||void 0,...be.params};if((be.loaded||be.loading)&&1!=l.page)return;be.loading=!0,await ue.request({url:`${fe.options.api}/app/plugin/info/page`,method:"POST",data:l}).then(e=>{const s=e.list.map(e=>({...e,label:e.name,name:"",logo:e.avatarUrl,author:e.nickName,doc:`https://cool-js.com/plugin/${e.id}`}));1==l.page?be.shop=s:be.shop.push(...s),be.loaded=be.shop.length>=e.pagination.total,be.params.page=e.pagination.page}).catch(e=>{m.error(e.message)}),be.loading=!1}else ue.plugin.info.page({size:1e3}).then(e=>{be.installed=e.list.concat(o(l.list.filter(e=>"plugins"==e.type&&e.label),"order","desc")).map(e=>{"COOL"==e.author&&(e.logo="https://cool-js.com/logo.png");const l="plugins"==e.type;return l?{...e,label:e.label||e.name,status:!1===e.enable?0:1,config:e.options||{},children:e.views,isVue:l}:{...e,logo:"data:image/jpg;base64,"+e.logo,label:e.name,name:e.keyName,config:e.config||{}}}).filter(e=>!be.keyWord||e.label.toLocaleLowerCase().includes(be.keyWord.toLocaleLowerCase()))})},onScroll:a(({scrollTop:e})=>{const{clientHeight:l,scrollHeight:s}=de.scrollbar.wrapRef;e+l>=s&&"shop"==_e.active&&be.refresh({page:be.params.page+1})},100)}),je=q({insert(e){const l=de.configInput.ref,s=l.selectionStart;l.value=l.value.slice(0,s)+(e||"")+l.value.slice(s)},formatter(){var e;try{return null==(e=de.config)||e.setForm("config",JSON.stringify(JSON.parse(de.config.form.config),null,4)),!0}catch(l){return m.error(ge("参数格式错误")+"："+l),!1}},onFileConfirm(e){const l=e.map(e=>e.url),s=l.length>1?JSON.stringify(l):l[0];je.insert(s)},open(e){var l;null==(l=de.config)||l.open({title:ge("设置"),form:{id:e.id,config:e.config},items:[{label:ge("参数"),prop:"config",component:{name:"el-input",props:{type:"textarea",rows:15},ref:me("configInput")}},{component:{name:"slot-tools"}}],on:{open(e){if(e.config||(e.config={}),r(e.config))try{e.config=JSON.parse(e.config)}catch(l){e.config={}}c(e.config)&&(e.config=JSON.stringify(e.config)),je.formatter()},submit(l,{done:s,close:t}){je.formatter()?ue.plugin.info.update(l).then(()=>{m.success(ge("修改成功")),n(e,l),t()}).catch(e=>{m.error(e.message),s()}):s()}}})},close(){var e;null==(e=de.config)||e.close()}}),ke=q({visible:!1,title:"",active:0,tabs:[],async open(e){r(e.demo)?p(e.demo,"http")?window.open(e.demo):T.push(e.demo):(ke.visible=!0,ke.active=0,ke.tabs=[],ke.title=e.label,ke.tabs=await Promise.all((e.demo||[]).map(async e=>{if(e){const l=await(u(e.component)?e.component():e.component);return{...e,component:W(l.default)}}})))},close(){ke.visible=!1}}),Ce=q({visible:!1,show:!1,index:0,list:[],preview(e){Ce.visible=!0,Ce.list=e},open(e){Ce.show=!0,Ce.index=e},close(){Ce.visible=!1},onClose(){Ce.show=!1},prev(){var e;null==(e=document.querySelector(".plugins__pics .list"))||e.scrollBy({left:-500,behavior:"smooth"})},next(){var e;null==(e=document.querySelector(".plugins__pics .list"))||e.scrollBy({left:500,behavior:"smooth"})}});function we(e){return he(e),!1}function xe(e){if(!ye.value)return!1;document.querySelectorAll(".plugins .list .item").forEach(l=>{const s=l.getBoundingClientRect(),t=e.clientX-s.left-250,a=e.clientY-s.top-250;"scroll"!==e.type&&requestAnimationFrame(()=>{l.style.setProperty("--x",`${t}px`),l.style.setProperty("--y",`${a}px`)})})}return _(()=>{be.init()}),(e,l)=>{var s,t;const a=y("cl-select-button"),i=y("cl-svg"),o=y("el-input"),n=y("cl-upload"),r=y("el-col"),c=y("cl-image"),p=y("el-tag"),u=y("cl-switch"),m=y("el-button"),v=y("el-row"),f=y("el-empty"),g=y("el-scrollbar"),h=y("el-tab-pane"),_=y("el-tabs"),U=y("cl-dialog"),q=y("el-image-viewer"),W=y("cl-editor-preview"),T=y("cl-upload-space"),ue=y("cl-form"),de=b("loading");return k(),j("div",B,[C("div",F,[x(a,{modelValue:_e.active,"onUpdate:modelValue":l[0]||(l[0]=e=>_e.active=e),options:_e.list,onChange:_e.onChange},null,8,["modelValue","options","onChange"]),x(o,{class:"search",modelValue:be.keyWord,"onUpdate:modelValue":l[1]||(l[1]=e=>be.keyWord=e),placeholder:e.$t("搜索插件名称"),clearable:"",onChange:l[2]||(l[2]=e=>be.refresh({page:1}))},{prefix:V(()=>[x(i,{name:"search",size:16})]),_:1},8,["modelValue","placeholder"])]),w((k(),j("div",A,[x(g,{ref:E(me)("scrollbar"),onScroll:be.onScroll},{default:V(()=>[C("div",{class:J(["list",{"is-installed":ye.value}]),onMousemove:xe},[x(v,{gutter:10},{default:V(()=>[ye.value?(k(),$(r,{key:0,xs:24,sm:12,md:8,lg:6},{default:V(()=>[C("div",I,[x(n,{"before-upload":we,accept:".cool"},{default:V(()=>[C("div",R,[x(i,{name:"plus"})])]),_:1})])]),_:1})):z("",!0),(k(!0),j(S,null,O(be[_e.active],(s,t)=>(k(),$(r,{key:t,xs:24,sm:12,md:8,lg:6},{default:V(()=>[C("div",D,[C("div",H,[ye.value&&!s.isVue?(k(),j("div",M,[C("div",{class:"cl-comm__icon is-delete",onClick:e=>be.remove(s,t)},[x(i,{name:"delete"})],8,G),C("div",{class:"cl-comm__icon is-set",onClick:e=>je.open(s)},[x(i,{name:"set"})],8,K)])):z("",!0),C("div",Q,[x(c,{class:"mr-[15px]",radius:6,src:s.logo,size:40},null,8,["src"]),C("div",X,[C("div",Y,[s.name?(k(),$(p,{key:0,"disable-transitions":"",size:"small",effect:"dark"},{default:V(()=>[P(L(s.name),1)]),_:2},1024)):z("",!0),x(p,{"disable-transitions":"",size:"small",effect:"plain"},{default:V(()=>[P(" v"+L(s.version||"1.0.0"),1)]),_:2},1024),ye.value?(k(),$(p,{key:1,"disable-transitions":"",size:"small",effect:"plain",type:s.isVue?"success":"info"},{default:V(()=>[P(L(s.isVue?"Vue":e.$t("后端")),1)]),_:2},1032,["type"])):z("",!0)]),C("p",Z,L(s.label||e.$t("未知")),1),C("p",ee,L(s.description||e.$t("暂无描述")),1),C("div",le,[C("span",null,L(s.author||"Ta")+"：",1),C("span",null,L(s.updateTime||"2025-01-01"),1)])])]),C("div",se,[!ye.value||s.isVue&&void 0===s.enable?z("",!0):(k(),$(u,{key:0,modelValue:s.status,"onUpdate:modelValue":e=>s.status=e,onChange:e=>be.onEnable(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])),l[9]||(l[9]=C("span",{class:"mr-auto"},null,-1)),s.demo?(k(),$(m,{key:1,type:"success",onClick:e=>ke.open(s)},{default:V(()=>[P(L(e.$t("示例")),1)]),_:2},1032,["onClick"])):z("",!0),E(d)(s.pics)?z("",!0):(k(),$(m,{key:2,type:"success",onClick:e=>Ce.preview(s.pics)},{default:V(()=>[P(L(e.$t("预览")),1)]),_:2},1032,["onClick"])),s.doc||s.readme?(k(),$(m,{key:3,onClick:e=>be.doc(s)},{default:V(()=>[P(L(e.$t("文档")),1)]),_:2},1032,["onClick"])):z("",!0)])])])]),_:2},1024))),128))]),_:1})],34),E(d)(be[_e.active])?(k(),$(f,{key:0,"image-size":80})):z("",!0)]),_:1},8,["onScroll"])])),[[de,be.loading]]),x(U,{modelValue:ke.visible,"onUpdate:modelValue":l[4]||(l[4]=e=>ke.visible=e),title:ke.title,width:"60%"},{default:V(()=>[x(_,{modelValue:ke.active,"onUpdate:modelValue":l[3]||(l[3]=e=>ke.active=e),type:"card"},{default:V(()=>[(k(!0),j(S,null,O(ke.tabs,(e,l)=>(k(),$(h,{key:l,label:e.name,name:l,lazy:0!=l},{default:V(()=>[(k(),$(N(e.component)))]),_:2},1032,["label","name","lazy"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"]),x(U,{modelValue:Ce.visible,"onUpdate:modelValue":l[8]||(l[8]=e=>Ce.visible=e),title:e.$t("图片预览"),width:"80%",padding:"0","hide-header":"",transparent:""},{default:V(()=>[C("div",te,[C("div",{class:"close",onClick:l[5]||(l[5]=(...e)=>Ce.close&&Ce.close(...e))},[x(i,{name:"close"})]),C("div",ae,[(k(!0),j(S,null,O(Ce.list,(e,l)=>(k(),j("div",{class:"item",key:l,onClick:e=>Ce.open(l)},[C("img",{src:e},null,8,oe)],8,ie))),128))]),C("div",ne,[C("div",{class:"prev",onClick:l[6]||(l[6]=(...e)=>Ce.prev&&Ce.prev(...e))},[x(i,{name:"left"})]),C("div",{class:"next",onClick:l[7]||(l[7]=(...e)=>Ce.next&&Ce.next(...e))},[x(i,{name:"right"})])])]),Ce.visible&&Ce.show?(k(),$(q,{key:0,"url-list":Ce.list,infinite:"","initial-index":Ce.index,teleported:"",onClose:Ce.onClose},null,8,["url-list","initial-index","onClose"])):z("",!0)]),_:1},8,["modelValue","title"]),x(W,{ref:E(me)("editorPreview"),name:"wang","show-btn":!1,title:`${null==(s=be.data)?void 0:s.name}（v${null==(t=be.data)?void 0:t.version}）${e.$t("说明文档")}`},{prepend:V(()=>{var l,s;return[C("div",re,[C("span",ce,L(e.$t("作者"))+"："+L(null==(l=be.data)?void 0:l.author),1),C("span",null,L(e.$t("更新时间"))+"："+L(null==(s=be.data)?void 0:s.updateTime),1)])]}),_:1},8,["title"]),x(ue,{ref:E(me)("config")},{"slot-tools":V(()=>[C("div",pe,[x(m,{type:"success",onClick:je.formatter},{default:V(()=>[P(L(e.$t("格式化")),1)]),_:1},8,["onClick"]),x(T,{"show-list":!1,text:e.$t("插入文件链接"),onConfirm:je.onFileConfirm},null,8,["text","onConfirm"])])]),_:1},512)])}}}),[["__scopeId","data-v-1f56c759"]]);export{de as default};
