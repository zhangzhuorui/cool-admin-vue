import{d as e,b as t,u as a,c as n,e as r}from"./comm-D8jqGG-6.js";import{u as s,e as l,r as o,f as i,P as p}from"./index-D3YIdvZh.js";import"./store@2.0.12-BfN7CKDu.js";import{w as d}from"./@vue_runtime-dom@3.5.18-D95plCo_.js";import{J as u}from"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import{u as m}from"./group-CbWLsH0h.js";import{a as c,E as v}from"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import{y as f}from"./lodash-es@4.17.21-DuLBTDIG.js";import{d as _,e as h,A as b,E as y,c as j,o as g,a as w,m as k,O as x,R as I,F as N,P as C,D as W,N as q,p as z}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{u as A}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{v as F,y as T}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import{P as E,p as G}from"./@vue_shared@3.5.18-BWKBh1Qo.js";import{_ as M}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./element-plus@2.10.4_vue@3.5.18_typescript@5.5.4_-BKZsM6nW.js";import"./dayjs@1.11.13-DxKHiy_y.js";import"./chardet@2.1.0-B0E1a5C9.js";import"./normalize-wheel-es@1.2.0-TzhA1irr.js";import"./@vueuse_core@9.13.0_vue@3.5.18_typescript@5.5.4_-CQVfZnDR.js";import"./@vueuse_shared@9.13.0_vue@3.5.18_typescript@5.5.4_-DyKSiD-b.js";import"./@ctrl_tinycolor@3.6.1-D2oWfImC.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-CyTP3PVf.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-B6jvMh_s.js";import"./mitt@3.0.1-BeZB7Ik_.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.18_typescript@5.5.4_-DPB-daMN.js";import"./vue-router@4.5.1_vue@3.5.18_typescript@5.5.4_-LCN95BWb.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.18_echarts@5.6.0_vue@3.5.18_typescript@5.5.4_-He2CYVXX.js";import"./echarts@5.6.0-D5a_RdwN.js";import"./tslib@2.3.0-ZseNXxlj.js";import"./zrender@5.6.1-BkMfNy7l.js";import"./axios@1.11.0-C-1G2k3o.js";import"./nprogress@0.2.0-Sg3Wh2FH.js";import"./@sxzz_popperjs-es@2.11.7-CT_jBSb5.js";import"./async-validator@4.2.5-j0i5Y79Y.js";import"./memoize-one@6.0.0-BAtLgO95.js";import"./@floating-ui_dom@1.7.2-CHufsicy.js";import"./@floating-ui_core@1.7.2-DWnBSKmT.js";import"./@floating-ui_utils@0.2.10-QZXVpxRV.js";import"./@intlify_core-base@11.1.10-C1bgUhoS.js";import"./@intlify_shared@11.1.10-BEv--mwN.js";import"./@intlify_message-compiler@11.1.10-JI08Nz38.js";const O={class:"dept-tree"},P={class:"dept-tree__header"},B={class:"dept-tree__op"},L={key:0,class:"btns"},R={class:"dept-tree__node"},U=["onClick"],V=_({name:"undefined"}),$=M(_({...V,name:"dept-list",props:{drag:{type:Boolean,default:!0},level:{type:Number,default:99}},emits:["refresh","user-add"],setup(a,{emit:n}){const r=a,p=n,{service:_,browser:M}=s(),V=e(),{ViewGroup:$}=m(),{t:D}=A(),J=F([]),K=F(!1),S=F(!1);function H({data:e}){return e.parentId}function Q(e,t){return t.data.parentId}async function X(){K.value=!0,S.value=!1,await _.base.sys.department.list().then(e=>{var t;J.value=l(e),(null==(t=$.value)?void 0:t.selected)||Y()}),K.value=!1}function Y(e){var t;if(e||(e=J.value[0]),e){const a=e.children?o(e.children).map(e=>e.id):[];a.unshift(e.id),null==(t=$.value)||t.select(e),z(()=>{p("refresh",{page:1,departmentIds:a})})}}function Z(e){var t;const a=e.id?"update":"add";null==(t=V.value)||t.open({title:D("编辑部门"),width:"550px",props:{labelWidth:"100px"},items:[{label:D("部门名称"),prop:"name",component:{name:"el-input"},required:!0},{label:D("上级部门"),prop:"parentName",component:{name:"el-input",props:{disabled:!0}}},{label:D("排序"),prop:"orderNum",component:{name:"el-input-number",props:{"controls-position":"right",min:0,max:100}}}],form:{...e},on:{submit(t,{done:n,close:r}){_.base.sys.department[a]({id:e.id,parentId:e.parentId,name:t.name,orderNum:t.orderNum}).then(()=>{v.success(D("新增部门 “{name}” 成功",{name:t.name})),r(),X()}).catch(e=>{v.error(e.message),n()})}}})}function ee(e){e?c.confirm(D("部门架构已发生改变，是否保存？"),D("提示"),{type:"warning"}).then(async()=>{const e=[];!function t(a,n){a.forEach(a=>{a.parentId=n,e.push(a),a.children&&f(a.children)&&t(a.children,a.id)})}(J.value,null),await _.base.sys.department.order(e.map((e,t)=>({id:e.id,parentId:e.parentId,orderNum:t}))).then(()=>{v.success(D("更新排序成功"))}).catch(e=>{v.error(e.message)}),X(),S.value=!1}).catch(()=>null):X()}function te(e,a,n){a||(a=J.value[0]||{});const s=_.base.sys.department.permission;t.open(e,{list:[{label:D("新增"),hidden:n&&n.level>=r.level||!i(s.add),callback(e){Z({name:"",parentName:a.name,parentId:a.id}),e()}},{label:D("编辑"),hidden:!i(s.update),callback(e){Z(a),e()}},{label:D("删除"),hidden:!a.parentId||!i(s.delete),callback(e){!function(e){async function t(t){await _.base.sys.department.delete({ids:[e.id],deleteUser:t}).then(()=>{var a,n;(null==(n=null==(a=$.value)?void 0:a.selected)?void 0:n.id)==e.id&&Y(),t?v.success(D("删除成功")):c.confirm(D("“{name}” 部门的用户已成功转移到 “{parentName}” 部门。",{name:e.name,parentName:e.parentName}),D("删除成功"))}),X()}c.confirm(D("此操作将会删除 “{name}” 部门的所有用户，是否确认？",{name:e.name}),D("提示"),{type:"warning",confirmButtonText:D("直接删除"),cancelButtonText:D("保留用户"),distinguishCancelAndClose:!0}).then(()=>{t(!0)}).catch(e=>{"cancel"==e&&t(!1)})}(a),e()}},{label:D("新增成员"),hidden:!i(s.add),callback(e){p("user-add",a),e()}}]})}return h(function(){X()}),(e,t)=>{const n=b("el-text"),r=b("cl-svg"),s=b("el-tooltip"),l=b("el-icon"),o=b("el-tree"),i=b("el-scrollbar"),p=b("cl-form"),m=y("loading");return g(),j("div",O,[w("div",P,[k(n,null,{default:x(()=>[I(E(T(D)("组织架构")),1)]),_:1}),w("div",B,[S.value?(g(),j("div",L,[w("div",{class:"item",onClick:t[0]||(t[0]=e=>ee(!0))},[k(r,{name:"success"})]),w("div",{class:"item",onClick:t[1]||(t[1]=e=>ee(!1))},[k(r,{name:"fail"})])])):(g(),j(N,{key:1},[w("div",{class:"item",onClick:t[2]||(t[2]=e=>X())},[k(s,{content:T(D)("刷新")},{default:x(()=>[k(r,{name:"refresh"})]),_:1},8,["content"])]),a.drag&&!T(M).isMini?(g(),j("div",{key:0,class:"item",onClick:t[3]||(t[3]=e=>S.value=!0)},[k(s,{content:T(D)("拖动排序")},{default:x(()=>[k(r,{name:"sort"})]),_:1},8,["content"])])):C("",!0)],64))])]),w("div",{class:"dept-tree__container",onContextmenu:d(te,["stop","prevent"])},[k(i,null,{default:x(()=>[W((g(),q(o,{"node-key":"id","default-expand-all":"",data:J.value,props:{label:"name"},"highlight-current":"",draggable:S.value,"allow-drag":H,"allow-drop":Q,"expand-on-click-node":!1,onNodeContextmenu:te,onNodeClick:Y},{default:x(({node:e,data:t})=>{var a,n;return[w("div",R,[w("span",{class:G(["dept-tree__node-label",{"is-active":t.id==(null==(n=null==(a=T($))?void 0:a.selected)?void 0:n.id)}])},E(e.label),3),T(M).isMini?(g(),j("span",{key:0,class:"dept-tree__node-icon",onClick:a=>te(a,t,e)},[k(l,null,{default:x(()=>[k(T(u))]),_:1})],8,U)):C("",!0)])]}),_:1},8,["data","draggable"])),[[m,K.value]])]),_:1})],32),k(p,{ref_key:"Form",ref:V},null,512)])}}}),[["__scopeId","data-v-33710bdb"]]),D={class:"dept-move"},J=_({name:"undefined"}),K=_({...J,name:"user-move",setup(t,{expose:n}){const{service:r}=s(),l=e(),o=a(),{t:i}=A();return n({open:async function(e){var t;null==(t=l.value)||t.open({title:i("部门转移"),width:"500px",props:{labelWidth:"80px"},items:[{label:i("选择部门"),prop:"departmentId",component:{name:"cl-dept-select"}}],on:{async submit(t,{done:a,close:n}){if(!t.departmentId)return v.warning(i("请选择部门")),a();await c.confirm(i("转移到新部门，是否继续？"),i("提示"),{type:"warning"}).then(()=>{r.base.sys.user.move({...t,userIds:e}).then(()=>{var e;v.success(i("转移成功")),null==(e=o.value)||e.refresh(),n()}).catch(e=>{v.error(e.message)})}).catch(()=>null),a()}}})}}),(e,t)=>{const a=b("cl-form");return g(),j("div",D,[k(a,{ref_key:"Form",ref:l},null,512)])}}}),S=_({name:"undefined"}),H=_({...S,name:"sys-user",setup(e){const{service:t,refs:l,setRefs:o}=s(),{t:i}=A(),{ViewGroup:d}=m({title:i("用户列表")}),u=a({service:t.base.sys.user}),c=n({columns:[{type:"selection",width:60},{prop:"headImg",label:i("头像"),component:{name:"cl-avatar",props:{size:32}}},{prop:"username",label:i("用户名"),minWidth:150},{prop:"name",label:i("姓名"),minWidth:120},{prop:"nickName",label:i("昵称"),minWidth:120},{prop:"departmentName",label:i("部门名称"),minWidth:120},{prop:"roleName",label:i("角色"),headerAlign:"center",minWidth:160,dict:[],formatter(e){var t;return null==(t=e.roleName)?void 0:t.split(",")}},{prop:"status",label:i("状态"),minWidth:100,component:{name:"cl-switch"}},{prop:"phone",label:i("手机号码"),minWidth:120},{prop:"remark",label:i("备注"),minWidth:200,showOverflowTooltip:!0},{prop:"createTime",label:i("创建时间"),sortable:"desc",minWidth:170},{type:"op",buttons:["slot-btn","edit","delete"],width:270}]}),v=r({dialog:{width:"800px"},items:[{prop:"headImg",label:i("头像"),component:{name:"cl-upload",props:{text:i("选择头像")}}},{prop:"name",label:i("姓名"),span:12,required:!0,component:{name:"el-input"}},{prop:"nickName",label:i("昵称"),required:!0,span:12,component:{name:"el-input"}},{prop:"username",label:i("用户名"),required:!0,span:12,component:{name:"el-input"}},()=>{var e;return{prop:"password",label:i("密码"),span:12,required:"add"==(null==(e=v.value)?void 0:e.mode),component:{name:"el-input",props:{type:"password",showPassword:!0,autocomplete:"new-password"}},rules:[{min:6,max:16,message:i("密码长度在 6 到 16 个字符")}]}},{prop:"roleIdList",label:i("角色"),value:[],required:!0,component:{name:"el-select",options:[],props:{multiple:!0,"multiple-limit":3}}},{prop:"phone",label:i("手机号码"),span:12,component:{name:"el-input"}},{prop:"email",label:i("邮箱"),span:12,component:{name:"el-input"}},{prop:"remark",label:i("备注"),component:{name:"el-input",props:{type:"textarea",rows:4}}},{prop:"status",label:i("状态"),value:1,component:{name:"el-radio-group",options:[{label:i("启用"),value:1},{label:i("禁用"),value:0}]}}],onSubmit(e,{next:t}){var a,n;t({departmentId:null==(n=null==(a=d.value)?void 0:a.selected)?void 0:n.id,...e})},async onOpen(){t.base.sys.role.list().then(e=>{var t;null==(t=v.value)||t.setOptions("roleIdList",e.map(e=>({label:e.name||"",value:e.id})))})},plugins:[p.Form.setFocus("name")]});function f(e){var t;null==(t=u.value)||t.refresh(e)}function _({id:e}){var t;null==(t=u.value)||t.rowAppend({departmentId:e})}async function h(e){var t;let a=[];a=e?[e.id]:(null==(t=c.value)?void 0:t.selection.map(e=>e.id))||[],l.userMove.open(a)}return(e,a)=>{const n=b("cl-refresh-btn"),r=b("cl-add-btn"),s=b("cl-multi-delete-btn"),l=b("el-button"),i=b("cl-flex1"),p=b("cl-search-key"),m=b("cl-row"),j=b("cl-table"),w=b("cl-pagination"),N=b("cl-upsert"),C=b("cl-crud"),z=b("cl-view-group"),A=y("permission");return g(),q(z,{ref_key:"ViewGroup",ref:d},{left:x(()=>[k($,{onRefresh:f,onUserAdd:_})]),right:x(()=>[k(C,{ref_key:"Crud",ref:u},{default:x(()=>[k(m,null,{default:x(()=>{var o;return[k(n),k(r),k(s),W((g(),q(l,{type:"success",disabled:0==(null==(o=T(c))?void 0:o.selection.length),onClick:a[0]||(a[0]=e=>h())},{default:x(()=>[I(E(e.$t("转移")),1)]),_:1},8,["disabled"])),[[A,T(t).base.sys.user.permission.move]]),k(i),k(p,{placeholder:e.$t("搜索用户名、姓名")},null,8,["placeholder"])]}),_:1}),k(m,null,{default:x(()=>[k(j,{ref_key:"Table",ref:c},{"slot-btn":x(({scope:a})=>[W((g(),q(l,{text:"",onClick:e=>h(a.row)},{default:x(()=>[I(E(e.$t("转移")),1)]),_:2},1032,["onClick"])),[[A,T(t).base.sys.user.permission.move]])]),_:1},512)]),_:1}),k(m,null,{default:x(()=>[k(i),k(w)]),_:1}),k(N,{ref_key:"Upsert",ref:v},null,512),k(K,{ref:T(o)("userMove")},null,512)]),_:1},512)]),_:1},512)}}});export{H as default};
