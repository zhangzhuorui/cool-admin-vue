import{w as e,v as i}from"./@vue_runtime-dom@3.5.18-D95plCo_.js";import{$ as l,a0 as s,D as a,T as t}from"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import{b as o}from"./comm-D8jqGG-6.js";import{m as r,q as n,u}from"./index-D3YIdvZh.js";import{F as p}from"./lodash-es@4.17.21-DuLBTDIG.js";import{b as c}from"./@vueuse_core@12.8.2_typescript@5.5.4-CyTP3PVf.js";import"./store@2.0.12-BfN7CKDu.js";import{d as m,A as d,E as v,c as f,o as _,F as y,a as g,m as b,N as w,P as k,O as h,D as j,p as C,v as x,w as P,e as I,a6 as E}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{u as $,y as M}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import{_ as O}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{E as R}from"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import{u as T}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{p as U,P as q,q as B}from"./@vue_shared@3.5.18-BWKBh1Qo.js";const{options:L}=r.get("upload"),V=L.rules||[];function A(e){return function(e){const i=V.find(i=>i.exts.find(i=>i==n(e||"").toLocaleLowerCase()));return(null==e?void 0:e.includes("data:image/"))?V.find(e=>"image"==e.type):i||V.find(e=>"file"==e.type)}(e).type}function D(e){return e.map(e=>e.url.replace(/,/g,encodeURIComponent(",")))}function F(...e){if(0===e.length)return"";let i=!1;e[0].startsWith("http")&&(i=!0);const l=e.map(e=>e.replace(/(^\/+|\/+$)/g,""));return l.join("/")}const S={class:"viewer-image"},z={class:"viewer-doc"},G=["src"],K=m({name:"undefined"}),N=O(m({...K,name:"file-viewer",setup(e,{expose:i}){const{refs:l,setRefs:s}=u(),a=$({visible:!1,url:""}),t=$({visible:!1,loading:!1,url:""});function o(){a.visible=!1}return i({open:function(e){if(null==e?void 0:e.type){const i=e.url||"",s=A(i);if("image"==s)return a.visible=!0,a.url=i,!0;if(["word","excel","ppt","pdf"].includes(s))return t.visible=!0,t.loading=!0,t.url=`https://view.officeapps.live.com/op/view.aspx?src=${decodeURIComponent(i)}`,C(()=>{l.docIframe.onload=()=>{t.loading=!1}}),!0;window.open(e.url)}}}),(e,i)=>{const l=d("el-image-viewer"),r=d("cl-dialog"),n=v("loading");return _(),f(y,null,[g("div",S,[a.visible?(_(),w(l,{key:0,"url-list":[a.url],infinite:"",teleported:"",onClose:o},null,8,["url-list"])):k("",!0)]),b(r,{modelValue:t.visible,"onUpdate:modelValue":i[0]||(i[0]=e=>t.visible=e),title:e.$t("文档预览"),height:"70vh",width:"80%",scrollbar:!1},{default:h(()=>[j((_(),f("div",z,[g("iframe",{ref:M(s)("docIframe"),src:t.url},null,8,G)])),[[n,t.loading]])]),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-ceba9158"]]),W={class:"cl-upload-item__wrap"},H=["src"],J={class:"cl-upload-item__icon"},Q={class:"cl-upload-item__name"},X=["src"],Y={class:"cl-upload-item__progress-bar"},Z={class:"cl-upload-item__progress-value"},ee={key:5,class:"cl-upload-item__actions"},ie=m({name:"undefined"}),le=O(m({...ie,name:"cl-upload-item",props:{item:{type:Object,required:!0},list:{type:Array,default:()=>[]},disabled:Boolean,deletable:Boolean,showTag:{type:Boolean,default:!0}},emits:["remove"],setup(r,{emit:m}){const v=r,C=m,{refs:O,setRefs:L}=u(),{copy:A}=c(),{t:D}=T(),F=x(()=>v.item.url||""),S=x(()=>{var e;return{color:(e=v.item.type,V.find(i=>i.type==(null==e?void 0:e.replace("application/","")))||p(V)).color,name:n(v.item.name||F.value)}});function z(){C("remove",v.item)}function G(){O.viewer.open(v.item)}function K(e){o.open(e,{hover:{target:"cl-upload-item__wrap"},list:[{label:D("预览"),callback(e){G(),e()}},{label:D("复制链接"),callback(e){v.item.url&&(A(v.item.url),R.success("复制成功")),e()}},{label:D("删除"),callback(e){z(),e()}}]})}const ie=$({isMedia:["video","audio"].includes(v.item.type),play(){v.list.forEach(e=>{e.isPlay=e.uid?v.item.uid==e.uid:v.item.id==e.id})},pause(){v.item.isPlay=!1},create(){if(!ie.isMedia)return!1;let e;P(()=>v.item.isPlay,i=>{e||(e=O[v.item.type],null==e||e.addEventListener("ended",()=>{ie.pause()})),i?null==e||e.play():null==e||e.pause()})}});return I(()=>{ie.create()}),(o,n)=>{const u=d("el-image"),p=d("cl-svg"),c=d("el-progress"),m=d("el-icon");return _(),f("div",W,[(_(),w(E,null,[g("div",{class:U(["cl-upload-item",[{"is-play":r.item.isPlay}]]),onContextmenu:e(K,["stop","prevent"])},["image"!==r.item.type||r.item.error?"video"===r.item.type?(_(),f("video",{ref:M(L)("video"),key:r.item.url,src:r.item.url},null,8,H)):(_(),f(y,{key:2},[g("div",J,[b(p,{name:"upload-"+r.item.type},null,8,["name"])]),g("div",Q,[g("span",null,q(r.item.name||F.value),1),j(g("span",{class:"error"},q(r.item.error),513),[[i,r.item.error]])])],64)):(_(),w(u,{key:0,class:"cl-upload-item__image-cover",fit:"contain",src:r.item.preload||F.value,onError:n[0]||(n[0]=e=>r.item.error=o.$t("加载失败"))},null,8,["src"])),"audio"===r.item.type?(_(),f("audio",{key:3,ref:M(L)("audio"),controls:""},[(_(),f("source",{key:r.item.url,src:r.item.url,type:"audio/mpeg"},null,8,X))],512)):k("",!0),g("div",{class:U(["cl-upload-item__progress",{"is-show":r.item.progress>=0&&r.item.progress<100,"is-hide":100==r.item.progress}])},[g("div",Y,[b(c,{percentage:r.item.progress,"show-text":!1},null,8,["percentage"])]),g("span",Z,q(r.item.progress),1)],2),r.showTag?(_(),f("span",{key:4,class:"cl-upload-item__tag",style:B({backgroundColor:S.value.color})},q(S.value.name),5)):k("",!0),F.value?(_(),f("div",ee,[ie.isMedia?(_(),f(y,{key:0},[r.item.isPlay?(_(),w(m,{key:0,class:"action-pause",onClick:n[1]||(n[1]=e(e=>ie.pause(),["stop"]))},{default:h(()=>[b(M(l))]),_:1})):(_(),w(m,{key:1,class:"action-play",onClick:n[2]||(n[2]=e(e=>ie.play(),["stop"]))},{default:h(()=>[b(M(s))]),_:1}))],64)):(_(),w(m,{key:1,class:"action-preview",onClick:e(G,["stop"])},{default:h(()=>[b(M(a))]),_:1})),!r.disabled||r.deletable?(_(),w(m,{key:2,class:"action-delete",onClick:e(z,["stop"])},{default:h(()=>[b(M(t))]),_:1})):k("",!0)])):k("",!0)],34)],1024)),b(N,{ref:M(L)("viewer")},null,512)])}}}),[["__scopeId","data-v-db8dbed7"]]),se=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"}));export{le as U,A as a,D as g,se as i,F as p};
