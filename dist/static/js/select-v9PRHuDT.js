import{w as e}from"./@vue_runtime-dom@3.5.18-D95plCo_.js";import{u as t,e as l}from"./index-D3YIdvZh.js";import{k as s}from"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import{d as a}from"./comm-D8jqGG-6.js";import{C as i}from"./index-l1IOnGdE.js";import{A as r,e as o,y as u}from"./lodash-es@4.17.21-DuLBTDIG.js";import{E as p}from"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import{d as n,v as c,e as m,w as d,A as v,c as _,o as f,a as h,m as y,F as j,a0 as b,N as g,O as k,P as x,R as V}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{u as w}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{v as C,u as $,y as z}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import{P as I}from"./@vue_shared@3.5.18-BWKBh1Qo.js";import{_ as U}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-CyTP3PVf.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-B6jvMh_s.js";import"./store@2.0.12-BfN7CKDu.js";import"./chardet@2.1.0-B0E1a5C9.js";import"./mitt@3.0.1-BeZB7Ik_.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.18_typescript@5.5.4_-DPB-daMN.js";import"./vue-router@4.5.1_vue@3.5.18_typescript@5.5.4_-LCN95BWb.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.18_echarts@5.6.0_vue@3.5.18_typescript@5.5.4_-He2CYVXX.js";import"./echarts@5.6.0-D5a_RdwN.js";import"./tslib@2.3.0-ZseNXxlj.js";import"./zrender@5.6.1-BkMfNy7l.js";import"./axios@1.11.0-C-1G2k3o.js";import"./nprogress@0.2.0-Sg3Wh2FH.js";import"./@vueuse_shared@9.13.0_vue@3.5.18_typescript@5.5.4_-DyKSiD-b.js";import"./@vueuse_core@9.13.0_vue@3.5.18_typescript@5.5.4_-CQVfZnDR.js";import"./@sxzz_popperjs-es@2.11.7-CT_jBSb5.js";import"./@ctrl_tinycolor@3.6.1-D2oWfImC.js";import"./dayjs@1.11.13-DxKHiy_y.js";import"./async-validator@4.2.5-j0i5Y79Y.js";import"./memoize-one@6.0.0-BAtLgO95.js";import"./normalize-wheel-es@1.2.0-TzhA1irr.js";import"./@floating-ui_dom@1.7.2-CHufsicy.js";import"./@floating-ui_core@1.7.2-DWnBSKmT.js";import"./@floating-ui_utils@0.2.10-QZXVpxRV.js";import"./element-plus@2.10.4_vue@3.5.18_typescript@5.5.4_-BKZsM6nW.js";import"./@intlify_core-base@11.1.10-C1bgUhoS.js";import"./@intlify_shared@11.1.10-BEv--mwN.js";import"./@intlify_message-compiler@11.1.10-JI08Nz38.js";const E={class:"mr-auto ml-[6px]"},N={key:1,class:"placeholder"},K={class:"cl-user-select__item"},S={class:"select-none"},A=n({name:"undefined"}),B=U(n({...A,name:"cl-user-select",props:{...i,modelValue:null,multiple:Boolean,placeholder:String,title:String,immediate:Boolean,labelKey:{type:String,default:"nickName"},maxCollapse:{type:Number,default:10}},emits:["update:modelValue","change"],setup(i,{expose:n,emit:U}){const A=i,B=U,{service:F,refs:P,setRefs:R}=t(),{t:q}=w(),D=a(),G=C([]),J=C(!1),L=C(""),O=$({active:"dept",list:[{label:q("按部门分组"),value:"dept"},{label:q("按角色分组"),value:"role"}]}),H=$({}),M=C([]),Q=c(()=>M.value.filter(e=>G.value.includes(e.id)));function T(e,t){return!e||t.name.includes(e)}function W(){P[`tree-${O.active}`].filter(L.value)}async function X(){J.value=!0,L.value="",await le(),O.list.forEach(e=>{P[`tree-${e.value}`].setCheckedKeys(G.value)})}function Y(){J.value=!1}function Z(){G.value=[],B("update:modelValue",void 0),B("change",void 0)}function ee(e,t){e.isUser&&(A.multiple?P[`tree-${O.active}`].setChecked(e,!t.checked,!1):(G.value=[e.id],te()))}function te(){var e;let t=G.value||[];if(A.multiple){t=P[`tree-${O.active}`].getCheckedNodes().filter(e=>e.isUser).map(e=>e.id)}if(r(t))return p.warning(q("请选择成员"));G.value=t,B("update:modelValue",G.value),B("change",Q.value),Y(),null==(e=D.value)||e.validateField(A.prop)}async function le(){await async function(){return F.base.sys.user.page({size:1e4}).then(e=>{M.value=e.list.map(e=>(e.isUser=!0,e))})}(),await async function(){return F.base.sys.department.list().then(e=>{e=l(e);const t=e=>{e.forEach(e=>{const l=M.value.filter(t=>t.departmentId===e.id&&1!=t.id);e.children||(e.children=[]),e.children.push(...o(l)),e.children&&!e.departmentId&&t(e.children)})};t(e),H.dept=e})}(),await async function(){return F.base.sys.role.list().then(e=>{e.forEach(e=>{e.children=M.value.filter(t=>t.roleIds.includes(e.id))}),H.role=e})}()}return m(()=>{A.immediate&&le(),d(()=>A.modelValue,e=>{let t=e||[];u(t)||(t=[t]),G.value=t},{immediate:!0})}),n({open:X,close:Y}),(t,l)=>{var a,o;const u=v("cl-avatar"),p=v("el-icon"),n=v("el-input"),c=v("el-tree"),m=v("el-scrollbar"),d=v("el-tab-pane"),w=v("el-tabs"),C=v("el-button"),$=v("cl-dialog");return f(),_(j,null,[h("div",{class:"cl-user-select",onClick:l[0]||(l[0]=e=>X())},[z(r)(Q.value)?(f(),_("span",N,I(i.placeholder||t.$t("请选择")),1)):(f(),_(j,{key:0},[i.multiple?(f(!0),_(j,{key:0},b(Q.value,(e,t)=>(f(),g(u,{key:t,src:e.headImg,size:24,class:"mr-[5px]"},null,8,["src"]))),128)):(f(),_(j,{key:1},[y(u,{size:24,src:null==(a=Q.value[0])?void 0:a.headImg},null,8,["src"]),h("span",E,I(null==(o=Q.value[0])?void 0:o[i.labelKey]),1)],64)),y(p,{class:"ml-auto",onClick:e(Z,["stop"])},{default:k(()=>[y(z(s))]),_:1})],64))]),y($,{modelValue:J.value,"onUpdate:modelValue":l[4]||(l[4]=e=>J.value=e),title:i.title||t.$t("选择成员"),controls:["close"],width:"600px"},{footer:k(()=>[y(C,{onClick:Y},{default:k(()=>[V(I(t.$t("取消")),1)]),_:1}),y(C,{type:"success",onClick:l[3]||(l[3]=e=>te())},{default:k(()=>[V(I(t.$t("确定")),1)]),_:1})]),default:k(()=>[y(w,{modelValue:O.active,"onUpdate:modelValue":l[2]||(l[2]=e=>O.active=e),type:"card"},{default:k(()=>[(f(!0),_(j,null,b(O.list,(e,s)=>(f(),g(d,{key:s,label:e.label,name:e.value},{default:k(()=>[y(n,{placeholder:t.$t("搜索名称"),modelValue:L.value,"onUpdate:modelValue":l[1]||(l[1]=e=>L.value=e),onInput:W},null,8,["placeholder","modelValue"]),y(m,{"max-height":"600px",class:"scrollbar"},{default:k(()=>[y(c,{ref_for:!0,ref:z(R)(`tree-${e.value}`),"node-key":"id","show-checkbox":i.multiple,data:H[e.value],props:{label:"name",class:e=>i.multiple?"":e.isUser&&G.value.includes(e.id)?"is-selected":""},"default-expand-all":"","filter-node-method":T,onNodeClick:ee},{default:k(({data:e})=>[h("div",K,[e.isUser?(f(),g(u,{key:0,class:"mr-[6px]",src:e.headImg,size:24},null,8,["src"])):x("",!0),h("span",S,I(e.name),1)])]),_:2},1032,["show-checkbox","data","props"])]),_:2},1024)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-ebe19f7f"]]);export{B as default};
