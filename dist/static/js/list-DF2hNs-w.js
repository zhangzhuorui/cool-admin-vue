import{w as e}from"./@vue_runtime-dom@3.5.18-D95plCo_.js";import{u as s,b as t}from"./index-D3YIdvZh.js";import"./store@2.0.12-BfN7CKDu.js";import{c as i,u as a,d as o,b as n}from"./comm-D8jqGG-6.js";import{d as l,A as r,N as p,o as c,O as m,m as u,p as d,I as f,E as _,c as v,a as k,D as h,F as y,a0 as b,R as j}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{u as g}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{v as x,u as w,y as C}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import{a as T,E as z}from"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import{P as $,p as D}from"./@vue_shared@3.5.18-BWKBh1Qo.js";import{_ as q}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-CyTP3PVf.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-B6jvMh_s.js";import"./lodash-es@4.17.21-DuLBTDIG.js";import"./mitt@3.0.1-BeZB7Ik_.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.18_typescript@5.5.4_-DPB-daMN.js";import"./vue-router@4.5.1_vue@3.5.18_typescript@5.5.4_-LCN95BWb.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.18_echarts@5.6.0_vue@3.5.18_typescript@5.5.4_-He2CYVXX.js";import"./echarts@5.6.0-D5a_RdwN.js";import"./tslib@2.3.0-ZseNXxlj.js";import"./zrender@5.6.1-BkMfNy7l.js";import"./axios@1.11.0-C-1G2k3o.js";import"./nprogress@0.2.0-Sg3Wh2FH.js";import"./chardet@2.1.0-B0E1a5C9.js";import"./@vueuse_shared@9.13.0_vue@3.5.18_typescript@5.5.4_-DyKSiD-b.js";import"./@vueuse_core@9.13.0_vue@3.5.18_typescript@5.5.4_-CQVfZnDR.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import"./@sxzz_popperjs-es@2.11.7-CT_jBSb5.js";import"./@ctrl_tinycolor@3.6.1-D2oWfImC.js";import"./dayjs@1.11.13-DxKHiy_y.js";import"./async-validator@4.2.5-j0i5Y79Y.js";import"./memoize-one@6.0.0-BAtLgO95.js";import"./normalize-wheel-es@1.2.0-TzhA1irr.js";import"./@floating-ui_dom@1.7.2-CHufsicy.js";import"./@floating-ui_core@1.7.2-DWnBSKmT.js";import"./@floating-ui_utils@0.2.10-QZXVpxRV.js";import"./element-plus@2.10.4_vue@3.5.18_typescript@5.5.4_-BKZsM6nW.js";import"./@intlify_core-base@11.1.10-C1bgUhoS.js";import"./@intlify_shared@11.1.10-BEv--mwN.js";import"./@intlify_message-compiler@11.1.10-JI08Nz38.js";const W=l({name:"undefined"}),Y=l({...W,name:"task-logs",setup(e,{expose:t}){const{service:o}=s(),{t:n}=g(),l=x(!1),f=x(""),_=w({status:[{label:n("成功"),value:1,type:"success"},{label:n("失败"),value:0,type:"danger"}]}),v=i({autoHeight:!1,columns:[{label:"#",type:"index"},{label:n("描述"),prop:"detail",showOverflowTooltip:!0,minWidth:200},{label:n("执行状态"),prop:"status",minWidth:120,dict:_.status},{label:n("执行时间"),prop:"createTime",minWidth:170}]}),k=a({service:o.task.info,dict:{api:{page:"log"}}});return t({open:function(e){l.value=!0,f.value=n("日志列表（{name}）",{name:e.name}),d(()=>{var s;null==(s=k.value)||s.refresh({id:e.id,page:1})})},close:function(){l.value=!1}}),(e,s)=>{const t=r("cl-refresh-btn"),i=r("cl-select"),a=r("cl-filter"),o=r("cl-row"),n=r("cl-table"),d=r("cl-flex1"),h=r("cl-pagination"),y=r("cl-crud"),b=r("cl-dialog");return c(),p(b,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=e=>l.value=e),title:f.value,width:"1000px"},{default:m(()=>[u(y,{ref_key:"Crud",ref:k,padding:"0"},{default:m(()=>[u(o,null,{default:m(()=>[u(t),u(a,{label:e.$t("状态")},{default:m(()=>[u(i,{options:_.status,prop:"status",width:120},null,8,["options"])]),_:1},8,["label"])]),_:1}),u(o,null,{default:m(()=>[u(n,{ref_key:"Table",ref:v},null,512)]),_:1}),u(o,null,{default:m(()=>[u(d),u(h)]),_:1})]),_:1},512)]),_:1},8,["modelValue","title"])}}}),E={class:"list"},H=["onClick","onContextmenu"],I={class:"name"},M={class:"row"},V={class:"row"},F={class:"status"},O=["onClick"],R=["onClick"],S=["onClick"],A=["onClick"],G=l({name:"undefined"}),J=q(l({...G,name:"task-list",setup(i){const{service:a,refs:l,setRefs:p}=s(),{browser:d}=t(),w=o(),{t:q}=g(),W=x([]);function G(){a.task.info.page({size:100,page:1}).then(e=>{W.value=e.list.map(e=>(e.every&&(e._every=parseInt(String(e.every/1e3))),e))})}function J(e){T.confirm(q("此操作将启用任务（{name}），是否继续？",{name:e.name}),"提示",{type:"warning"}).then(()=>{a.task.info.start({id:e.id,type:e.type}).then(()=>{G()}).catch(e=>{z.error(e.message)})}).catch(()=>null)}function K(e){T.confirm(q("此操作将停用任务（{name}），是否继续？",{name:e.name}),"提示",{type:"warning"}).then(()=>{a.task.info.stop({id:e.id}).then(()=>{G()}).catch(e=>{z.error(e.message)})}).catch(()=>null)}function L(e){T.confirm(q("此操作将删除任务（{name}），是否继续？",{name:e.name}),"提示",{type:"warning"}).then(()=>{a.task.info.delete({ids:[e.id]}).then(()=>{G()}).catch(e=>{z.error(e.message)})}).catch(()=>null)}function N(e){l.log.open(e)}async function P(e){var s;if(e&&!a.task.info._permission.update)return!1;null==(s=w.value)||s.open({title:q("编辑计划任务"),width:"600px",props:{labelWidth:"80px"},items:[{label:q("名称"),prop:"name",component:{name:"el-input",props:{placeholder:"请输入名称"}},required:!0},{label:q("类型"),prop:"taskType",value:0,component:{name:"el-radio-group",options:[{label:"cron",value:0},{label:q("时间间隔"),value:1}]},required:!0},{label:"cron",prop:"cron",hidden:({scope:e})=>1==e.taskType,component:{name:"el-input",props:{placeholder:"* * * * * *"}},required:!0},{label:q("间隔(秒)"),prop:"every",hidden:({scope:e})=>0==e.taskType,hook:{bind:e=>e/1e3,submit:e=>1e3*e},component:{name:"el-input-number",props:{min:1,max:1e8}},required:!0},{label:"service",prop:"service",component:{name:"el-input",props:{placeholder:"taskDemoService.test([1, 2])"}}},{label:q("开始时间"),prop:"startDate",hidden:({scope:e})=>1==e.taskType,component:{name:"el-date-picker",props:{type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"}}},{label:q("备注"),prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:3}}}],form:{...e},on:{submit:(s,{close:t,done:i})=>{s.limit||(s.limit=null),a.task.info[(null==e?void 0:e.id)?"update":"add"](s).then(()=>{G(),z.success(q("保存成功")),t()}).catch(e=>{z.error(e.message),i()})}}})}function U(e,s){n.open(e,{list:[s.status?{label:q("暂停"),hidden:!a.task.info._permission.stop,callback(e){K(s),e()}}:{label:q("开始"),hidden:!a.task.info._permission.start,callback(e){J(s),e()}},{label:q("立即执行"),hidden:!a.task.info._permission.once,callback(e){!function(e){a.task.info.once({id:e.id}).then(()=>{G()}).catch(e=>{z.error(e.message)})}(s),e()}},{label:q("编辑"),hidden:!(a.task.info._permission.update&&a.task.info._permission.info),callback(e){P(s),e()}},{label:q("删除"),hidden:!a.task.info._permission.delete,callback(e){L(s),e()}},{label:q("查看日志"),hidden:!a.task.info._permission.log,callback(e){N(s),e()}}]})}return f(()=>{G()}),(s,t)=>{const i=r("cl-svg"),o=r("el-tag"),n=r("cl-form"),l=_("permission");return c(),v("div",{class:D(["task-list",{"is-mini":C(d).isMini}])},[k("div",E,[(c(!0),v(y,null,b(W.value,(n,r)=>(c(),v("div",{key:r,class:"item",onClick:e=>P(n),onContextmenu:e=>{U(e,n)}},[k("p",I,$(n.name),1),k("p",M,[k("span",null,$(s.$t("执行服务")),1),k("span",null,$(n.service),1)]),k("p",V,[k("span",null,$(s.$t("定时规则")),1),k("span",null,$(1==n.taskType?s.$t("间隔{every}秒执行",{every:n._every}):n.cron),1)]),k("div",F,[n.status?(c(),v(y,{key:0},[h((c(),v("div",{class:"icon",onClick:e(e=>K(n),["stop"])},[u(i,{name:"close-border"})],8,O)),[[l,C(a).task.info.permission.stop]]),u(o,{"disable-transitions":"",effect:"plain",type:"success"},{default:m(()=>[j($(s.$t("进行中")),1)]),_:1})],64)):(c(),v(y,{key:1},[h((c(),v("div",{class:"icon",onClick:e(e=>J(n),["stop"])},[u(i,{name:"play"})],8,R)),[[l,C(a).task.info.permission.start]]),u(o,{"disable-transitions":"",effect:"plain",type:"danger"},{default:m(()=>[j($(s.$t("已停止")),1)]),_:1})],64)),t[1]||(t[1]=k("div",{class:"flex1"},null,-1)),h((c(),v("div",{class:"icon",onClick:e(e=>N(n),["stop"])},[u(i,{name:"order"})],8,S)),[[l,C(a).task.info.permission.log]]),h((c(),v("div",{class:"icon",onClick:e(e=>L(n),["stop"])},[u(i,{name:"delete"})],8,A)),[[l,C(a).task.info.permission.delete]])])],40,H))),128)),h((c(),v("div",{class:"item is-add",onClick:t[0]||(t[0]=e=>P())},[u(i,{name:"plus",size:36}),k("p",null,$(s.$t("添加计划任务")),1)])),[[l,C(a).task.info.permission.add]])]),u(n,{ref_key:"Form",ref:w},null,512),u(Y,{ref:C(p)("log")},null,512)],2)}}}),[["__scopeId","data-v-9d099285"]]);export{J as default};
