import{w as e}from"./@vue_runtime-dom@3.5.18-D95plCo_.js";import{d as t,c as l,g as a,u as s}from"./comm-D8jqGG-6.js";import{u as i}from"./index-D3YIdvZh.js";import"./store@2.0.12-BfN7CKDu.js";import{k as r}from"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import{C as o}from"./index-l1IOnGdE.js";import{o as u,A as p,e as n,y as c}from"./lodash-es@4.17.21-DuLBTDIG.js";import{d,v as m,w as v,A as f,c as _,o as y,a as j,m as g,F as k,P as h,O as b,R as x,N as w,a0 as z,M as C,p as $}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{u as S}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{v as T,u as V,y as A}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import{P as R}from"./@vue_shared@3.5.18-BWKBh1Qo.js";import{_ as P}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./element-plus@2.10.4_vue@3.5.18_typescript@5.5.4_-BKZsM6nW.js";import"./dayjs@1.11.13-DxKHiy_y.js";import"./chardet@2.1.0-B0E1a5C9.js";import"./normalize-wheel-es@1.2.0-TzhA1irr.js";import"./@vueuse_core@9.13.0_vue@3.5.18_typescript@5.5.4_-CQVfZnDR.js";import"./@vueuse_shared@9.13.0_vue@3.5.18_typescript@5.5.4_-DyKSiD-b.js";import"./@ctrl_tinycolor@3.6.1-D2oWfImC.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-CyTP3PVf.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-B6jvMh_s.js";import"./mitt@3.0.1-BeZB7Ik_.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.18_typescript@5.5.4_-DPB-daMN.js";import"./vue-router@4.5.1_vue@3.5.18_typescript@5.5.4_-LCN95BWb.js";import"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import"./@sxzz_popperjs-es@2.11.7-CT_jBSb5.js";import"./async-validator@4.2.5-j0i5Y79Y.js";import"./memoize-one@6.0.0-BAtLgO95.js";import"./@floating-ui_dom@1.7.2-CHufsicy.js";import"./@floating-ui_core@1.7.2-DWnBSKmT.js";import"./@floating-ui_utils@0.2.10-QZXVpxRV.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.18_echarts@5.6.0_vue@3.5.18_typescript@5.5.4_-He2CYVXX.js";import"./echarts@5.6.0-D5a_RdwN.js";import"./tslib@2.3.0-ZseNXxlj.js";import"./zrender@5.6.1-BkMfNy7l.js";import"./axios@1.11.0-C-1G2k3o.js";import"./nprogress@0.2.0-Sg3Wh2FH.js";import"./@intlify_core-base@11.1.10-C1bgUhoS.js";import"./@intlify_shared@11.1.10-BEv--mwN.js";import"./@intlify_message-compiler@11.1.10-JI08Nz38.js";const O={class:"cl-select-table__picker"},U={class:"mb-[10px]"},B={key:0,class:"placeholder"},E={key:0},F={key:1},M={key:0},N=d({name:"undefined"}),q=P(d({...N,name:"cl-select-table",props:{...o,modelValue:null,scope:Object,title:String,placeholder:String,service:null,showPicker:{type:Boolean,default:!0},pickerType:{type:String,default:"default"},dict:Object,multiple:{type:Boolean,default:!0},columns:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(o,{expose:d,emit:P}){const{t:N}=S(),q=o,D=P,{refs:G,setRefs:I}=i(),J=u({id:"id",img:"avatarUrl",text:"nickName"},q.dict),K=t(),L=l({contextMenu:["refresh","order-desc","order-asc"],columns:[q.multiple?{type:"selection",width:60,reserveSelection:!0}:{label:N("操作"),prop:"check",width:100},...q.columns]}),H=a(),Q=s({service:q.service,async onRefresh(e,{next:t}){const l=await t(e);te.value.push(...l.list.map(e=>e[J.id])),Y.value.forEach(e=>{var t,l;const a=null==(t=L.value)?void 0:t.data.find(t=>t[J.id]==e[J.id]);a&&(null==(l=L.value)||l.toggleRowSelection(a,!0))})}});const W=T(!1),X=T([]),Y=T([]),Z=V({page:1,size:10}),ee=m(()=>{if("table"==q.pickerType){const{page:e,size:t}=Z;return X.value.slice((e-1)*t,e*t)}return X.value}),te=T([]);function le(e){const t=Array.from(new Set(te.value));Y.value=Y.value.filter(e=>!t.includes(e[J.id])).concat(...e)}function ae(){W.value=!0,te.value=[],Y.value=n(X.value),$(()=>{!async function(e){var t;null==(t=Q.value)||t.refresh(e)}({size:10})})}function se(){W.value=!1}function ie(e){e&&(Y.value=[e]),X.value=n(Y.value||[]),se()}async function re(){var e;await(null==(e=Q.value)?void 0:e.refresh({page:1,size:1e4}).then(e=>{X.value=e.list})),se()}function oe(){var e;if("table"==q.pickerType){const t=((null==(e=G.table)?void 0:e.selection)||[]).map(e=>e[J.id]);X.value=X.value.filter(e=>{var l;return null==(l=G.table)||l.toggleRowSelection(e,!1),!t.find(t=>t==e[J.id])})}else X.value=[]}return v(X,(e=[])=>{var t;const l=e.map(e=>e[J.id]);q.multiple?D("update:modelValue",l):D("update:modelValue",l[0]),null==(t=K.value)||t.validateField(q.prop)},{deep:!0}),d({set:function(e){X.value=n(c(e)?e:[e])},remove:oe,select:ie,selectAll:re}),(t,l)=>{var a;const s=f("el-button"),i=f("cl-table"),u=f("cl-row"),n=f("el-pagination"),c=f("cl-crud"),d=f("cl-image"),m=f("el-tag"),v=f("el-icon"),$=f("cl-refresh-btn"),S=f("cl-flex1"),T=f("cl-search"),V=f("cl-pagination"),P=f("cl-dialog");return y(),_(k,null,[j("div",O,["table"==o.pickerType?(y(),_(k,{key:0},[o.multiple?(y(),_(k,{key:0},[j("div",U,[g(s,{type:"success",onClick:ae},{default:b(()=>[x(R(t.$t("添加")),1)]),_:1}),g(s,{type:"danger",disabled:0==(null==(a=A(G).table)?void 0:a.selection.length),onClick:l[0]||(l[0]=e=>oe())},{default:b(()=>[x(R(t.$t("移除")),1)]),_:1},8,["disabled"])]),g(c,{padding:"0"},{default:b(()=>[g(u,null,{default:b(()=>[g(i,{ref:A(I)("table"),data:ee.value,"auto-height":!1},null,8,["data"])]),_:1}),g(u,{type:"flex",align:"middle",justify:"end"},{default:b(()=>[g(n,{"current-page":Z.page,"onUpdate:currentPage":l[1]||(l[1]=e=>Z.page=e),"page-size":Z.size,total:X.value.length,background:"",layout:"total, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])]),_:1})]),_:1})],64)):h("",!0)],64)):(y(),_("div",{key:1,class:"cl-select-table__picker-inner",onClick:ae},[A(p)(ee.value)?(y(),_("span",B,R(o.placeholder||t.$t("请选择")),1)):(y(!0),_(k,{key:1},z(ee.value,(e,l)=>C(t.$slots,"item",{key:l,item:e,index:l},()=>["default"==o.pickerType?(y(),_(k,{key:0},[g(d,{src:e[A(J).img],size:24,radius:5,preview:!1,class:"mr-[5px]"},null,8,["src"]),o.multiple?h("",!0):(y(),_("span",E,R(e[A(J).text]),1))],64)):"text"==o.pickerType?(y(),_(k,{key:1},[o.multiple?(y(),w(m,{key:0,"disable-transitions":"",size:"small",effect:"plain"},{default:b(()=>[x(R(e[A(J).text]),1)]),_:2},1024)):(y(),_("span",F,R(e[A(J).text]),1))],64)):h("",!0)],!0)),128)),A(p)(ee.value)?h("",!0):(y(),w(v,{key:2,onClick:l[2]||(l[2]=e(e=>oe(),["stop"]))},{default:b(()=>[g(A(r))]),_:1}))]))]),g(P,{modelValue:W.value,"onUpdate:modelValue":l[4]||(l[4]=e=>W.value=e),width:"1200px",title:o.title},{footer:b(()=>[g(s,{onClick:se},{default:b(()=>[x(R(t.$t("取消")),1)]),_:1}),o.multiple?(y(),w(s,{key:0,type:"success",disabled:A(p)(Y.value),onClick:l[3]||(l[3]=e=>ie())},{default:b(()=>[x(R(t.$t("选择")),1)]),_:1},8,["disabled"])):h("",!0)]),default:b(()=>[g(c,{ref_key:"Crud",ref:Q,padding:"0"},{default:b(()=>[g(u,null,{default:b(()=>[g($),o.multiple?(y(),w(s,{key:0,type:"primary",onClick:re},{default:b(()=>[x(R(t.$t("全选")),1)]),_:1})):h("",!0),g(S),g(T,{ref_key:"Search",ref:H},null,512)]),_:1}),g(u,null,{default:b(()=>[g(i,{ref_key:"Table",ref:L,"auto-height":!1,onSelectionChange:le},{"column-check":b(({scope:e})=>{var l;return[(null==(l=Y.value[0])?void 0:l[A(J).id])==e.row[A(J).id]?(y(),w(s,{key:0,type:"success",disabled:""},{default:b(()=>[x(R(t.$t("已选")),1)]),_:1})):(y(),w(s,{key:1,onClick:t=>ie(e.row)},{default:b(()=>[x(R(t.$t("选择")),1)]),_:2},1032,["onClick"]))]}),_:1},512)]),_:1}),g(u,null,{default:b(()=>[o.multiple?(y(),_("span",M,R(t.$t("已选"))+" "+R(Y.value.length)+" "+R(t.$t("人")),1)):h("",!0),g(S),g(V)]),_:1})]),_:1},512)]),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-318f2996"]]);export{q as default};
