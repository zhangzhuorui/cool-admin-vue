import{v as e}from"./@vue_runtime-dom@3.5.18-D95plCo_.js";import{_ as a}from"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import{u as l}from"./index-D3YIdvZh.js";import"./store@2.0.12-BfN7CKDu.js";import{u as i}from"./group-CbWLsH0h.js";import{U as s}from"./index-aA9QvOjo.js";import{E as t,a as n}from"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import{B as o}from"./lodash-es@4.17.21-DuLBTDIG.js";import{d as c,w as r,A as p,E as u,c as d,o as f,m,O as v,a as g,D as _,N as h,P as y,R as b,F as x,a0 as j,K as w}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{u as k}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{v as z,u as C,y as E}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import{P as D,p as I}from"./@vue_shared@3.5.18-BWKBh1Qo.js";const $={class:"cl-upload-space-inner__right"},P={class:"cl-upload-space-inner__header"},U={style:{margin:"0px 10px"}},G=["onClick"],M={class:"cl-upload-space-inner__file-index"},R={key:1,class:"cl-upload-space-inner__file-empty"},S={class:"cl-upload-space-inner__footer cl-pagination"},T=c({name:"undefined"}),B=c({...T,name:"cl-upload-space-inner",props:{limit:{type:Number,default:99},accept:String,selectable:Boolean},emits:["selection-change","confirm"],setup(c,{expose:T,emit:B}){const K=c,N=B,{service:V,browser:q,refs:A,setRefs:F}=l(),{t:O}=k(),{ViewGroup:H}=i({label:O("分类"),title:O("文件列表"),service:V.space.type,onEdit:()=>({width:"400px",props:{labelPosition:"top"},dialog:{controls:["close"]},items:[{label:O("名称"),prop:"name",value:"",required:!0,component:{name:"el-input",props:{maxlength:20,clearable:!0}}}]}),onSelect(e){ee({classifyId:e.id,page:1})}}),J=z(!1),L=z([]),Q=z([]),W=C({page:1,size:20,total:0});function X(e){var a,l;V.space.info.add({classifyId:null==(l=null==(a=H.value)?void 0:a.selected)?void 0:l.id,...e}).then(a=>{e.id=a.id}).catch(e=>{t.error(e.message)})}function Y(e){Q.value.unshift(e)}const Z={page:1};async function ee(e){var a;o(Z,{type:(null==(a=K.accept)?void 0:a.split("/")[0].replace("*",""))||void 0,...W,...e}),1==Z.page&&(J.value=!0),await V.space.info.page(Z).then(e=>{o(W,e.pagination),Q.value=e.list}),J.value=!1}function ae(e){return L.value.findIndex(a=>a.id===e)+1}function le(e){const a=e?[e.id]:L.value.map(e=>e.id);n.confirm(O("此操作将删除文件, 是否继续?"),O("提示"),{type:"warning"}).then(()=>{t.success(O("删除成功")),a.forEach(e=>{[Q.value,L.value].forEach(a=>{const l=a.findIndex(a=>a.id===e);a.splice(l,1)})}),V.space.info.delete({ids:a}).catch(e=>{t.error(e.message)})}).catch(()=>null)}function ie(e){e.preventDefault()}function se(e){e.preventDefault(),e.dataTransfer&&e.dataTransfer.files.forEach((e,a)=>{setTimeout(()=>{A.upload.upload(e)},10*a)})}return r(L,e=>{N("selection-change",e)},{deep:!0}),w("space",{selection:L,refresh:ee,loading:J,list:Q}),T({selection:L,open:open,close:close,clear:function(){L.value=[]},refresh:ee}),(l,i)=>{const n=p("el-button"),o=p("cl-upload"),r=p("el-icon"),w=p("el-scrollbar"),k=p("el-pagination"),z=p("cl-view-group"),C=u("loading");return f(),d("div",{class:"cl-upload-space-inner",onDragover:ie,onDrop:se},[m(z,{ref_key:"ViewGroup",ref:H},{right:v(()=>[g("div",$,[g("div",P,[m(n,{onClick:i[0]||(i[0]=e=>ee({page:1}))},{default:v(()=>[b(D(l.$t("刷新")),1)]),_:1}),g("div",U,[m(o,{ref:E(F)("upload"),menu:"space",type:"file",multiple:"","show-file-list":!1,limit:9999,accept:c.accept,onSuccess:X,onUpload:Y},{default:v(()=>[m(n,{type:"primary"},{default:v(()=>[b(D(l.$t("点击上传")),1)]),_:1})]),_:1},8,["accept"])]),c.selectable?y("",!0):(f(),h(n,{key:0,type:"danger",disabled:0==L.value.length,onClick:i[1]||(i[1]=e=>le())},{default:v(()=>[b(D(l.$t("删除选中文件")),1)]),_:1},8,["disabled"]))]),_((f(),h(w,{class:"cl-upload-space-inner__file"},{default:v(()=>[Q.value.length>0?(f(),d("div",{key:0,class:I(["cl-upload-space-inner__file-list",{"is-mini":E(q).isMini}])},[(f(!0),d(x,null,j(Q.value,a=>(f(),d("div",{key:a.preload||a.url,class:"cl-upload-space-inner__file-item",onClick:e=>function(e){const a=L.value.findIndex(a=>a.id===e.id);a>=0?L.value.splice(a,1):1==K.limit?L.value=[e]:L.value.length<K.limit?L.value.push(e):t.warning(O("最多只能选择{limit}个文件",{limit:K.limit}))}(a)},[m(s,{item:a,list:Q.value,onRemove:le},null,8,["item","list"]),_(g("div",M,[g("span",null,D(ae(a.id)),1)],512),[[e,ae(a.id)]])],8,G))),128))],2)):(f(),d("div",R,[m(r,{class:"el-icon--upload"},{default:v(()=>[m(E(a))]),_:1}),g("p",null,D(l.$t("将文件拖到此处，或点击按钮上传")),1)]))]),_:1})),[[C,J.value]]),g("div",S,[m(k,{"current-page":W.page,"onUpdate:currentPage":i[2]||(i[2]=e=>W.page=e),size:E(q).isMini?"small":"default",total:W.total,"default-page-size":W.size,background:"",layout:"prev, pager, next",onCurrentChange:i[3]||(i[3]=e=>ee())},null,8,["current-page","size","total","default-page-size"]),_(g("span",{class:"total"},D(l.$t("共 {total} 条",{total:W.total})),513),[[e,!E(q).isMini]])])])]),_:1},512)],32)}}});export{B as _};
