import{w as e}from"./@vue_runtime-dom@3.5.18-D95plCo_.js";import{d as t}from"./comm-D8jqGG-6.js";import{r as i,u as s}from"./xlsx@0.18.5-DF0p_WFv.js";import{b as o}from"./chardet@2.1.0-B0E1a5C9.js";import{q as a}from"./index-D3YIdvZh.js";import{E as l}from"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import{K as n}from"./lodash-es@4.17.21-DuLBTDIG.js";import{d as r,v as p,A as c,c as d,o as u,m,O as f,R as _,P as g,a as y,F as v,a0 as h,N as j}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{u as b}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{u as x}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import{P as C}from"./@vue_shared@3.5.18-BWKBh1Qo.js";import{_ as S}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import"./element-plus@2.10.4_vue@3.5.18_typescript@5.5.4_-BKZsM6nW.js";import"./dayjs@1.11.13-DxKHiy_y.js";import"./normalize-wheel-es@1.2.0-TzhA1irr.js";import"./@vueuse_core@9.13.0_vue@3.5.18_typescript@5.5.4_-CQVfZnDR.js";import"./@vueuse_shared@9.13.0_vue@3.5.18_typescript@5.5.4_-DyKSiD-b.js";import"./@ctrl_tinycolor@3.6.1-D2oWfImC.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-CyTP3PVf.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-B6jvMh_s.js";import"./store@2.0.12-BfN7CKDu.js";import"./mitt@3.0.1-BeZB7Ik_.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.18_typescript@5.5.4_-DPB-daMN.js";import"./vue-router@4.5.1_vue@3.5.18_typescript@5.5.4_-LCN95BWb.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.18_echarts@5.6.0_vue@3.5.18_typescript@5.5.4_-He2CYVXX.js";import"./echarts@5.6.0-D5a_RdwN.js";import"./tslib@2.3.0-ZseNXxlj.js";import"./zrender@5.6.1-BkMfNy7l.js";import"./axios@1.11.0-C-1G2k3o.js";import"./nprogress@0.2.0-Sg3Wh2FH.js";import"./@sxzz_popperjs-es@2.11.7-CT_jBSb5.js";import"./async-validator@4.2.5-j0i5Y79Y.js";import"./memoize-one@6.0.0-BAtLgO95.js";import"./@floating-ui_dom@1.7.2-CHufsicy.js";import"./@floating-ui_core@1.7.2-DWnBSKmT.js";import"./@floating-ui_utils@0.2.10-QZXVpxRV.js";import"./@intlify_core-base@11.1.10-C1bgUhoS.js";import"./@intlify_shared@11.1.10-BEv--mwN.js";import"./@intlify_message-compiler@11.1.10-JI08Nz38.js";const w={key:0,class:"upload"},k={key:0,class:"tips"},z={class:"inner"},$={key:0,class:"data-table"},A={class:"head"},F={class:"cl-table"},B={key:0},U={class:"pagination"},V=r({name:"undefined"}),q=S(r({...V,name:"cl-import-btn",props:{onConfig:Function,onSubmit:Function,template:{type:String,default:""},tips:String,limitSize:{type:Number,default:10},type:{type:String,default:"success"},icon:String,disabled:Boolean,accept:{type:String,default:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel,text/csv"}},emits:["change"],setup(r,{expose:S,emit:V}){const q=r,E=V,I=t(),{t:N}=b(),O=p(()=>q.tips||N("请按照模版填写信息")),P=x({filename:"",file:null,list:[]}),R=x({size:20,page:1,onCurrentChange(e){R.page=e}}),D=x({header:[],selection:[],del(e){void 0!==e?P.list.splice(e,1):P.list=P.list.filter(e=>!D.selection.includes(e._index))},onIndex:e=>e+1+(R.page-1)*R.size,onSelectionChange(e){D.selection=e.map(e=>e._index)}}),K=p(()=>P.list.filter((e,t)=>t>=(R.page-1)*R.size&&t<R.page*R.size));function T(){P.filename="",P.file=null,P.list=[],D.header=[],D.selection=[]}function G(){var e;T(),null==(e=I.value)||e.open({title:N("导入"),width:p(()=>P.filename?"80%":"800px"),dialog:{"close-on-press-escape":!1},items:[...q.onConfig?q.onConfig(I):[],{prop:"file",component:{name:"slot-upload"}},{component:{name:"slot-list"}}],op:{saveButtonText:N("提交")},on:{submit(e,{done:t,close:i}){if(!P.filename)return t(),l.error(N("请选择文件"));q.onSubmit?q.onSubmit({...P,...e},{done:t,close:i}):(l.error(N("[cl-import-btn] onSubmit is required")),t())}}})}function J(e,t,{next:l}){const r=new FileReader,p=a(e.name);return r.onload=t=>{var a;let l="";if("csv"==p){const e=o.detect(new Uint8Array(t.target.result));l=new TextDecoder(e).decode(t.target.result)}else l=t.target.result;const r=i(l,{type:"binary",raw:"csv"==p});let c=[];for(const e in r.Sheets)n(r.Sheets,e)&&(c=c.concat(s.sheet_to_json(r.Sheets[e],{raw:!1,dateNF:"yyyy-mm-dd",defval:""})));P.list=c.map((e,t)=>({...e,_index:t})),P.filename=e.name,P.file=e;const d=r.Sheets[Object.keys(r.Sheets)[0]];for(const e in d){if("!"===e[0])continue;"1"==(null==(a=e.match(/[0-9]+/))?void 0:a[0])&&D.header.push(d[e].v)}E("change",c)},"csv"==p?r.readAsArrayBuffer(e):r.readAsBinaryString(e),l(),!1}function L(){const e=document.createElement("a");e.setAttribute("href",q.template),e.setAttribute("download",""),e.click()}return S({open:G,clear:T,Form:I}),(t,i)=>{const s=c("el-button"),o=c("cl-upload"),a=c("el-table-column"),l=c("el-input"),n=c("el-table"),p=c("el-pagination"),b=c("cl-form");return u(),d(v,null,[m(s,{icon:r.icon,disabled:r.disabled,type:r.type,onClick:G},{default:f(()=>[_(C(t.$t("导入")),1)]),_:1},8,["icon","disabled","type"]),m(b,{ref_key:"Form",ref:I},{"slot-upload":f(()=>[P.filename?g("",!0):(u(),d("div",w,[r.template?(u(),d("div",k,[y("span",null,C(O.value),1),m(s,{type:"primary",text:"",bg:"",onClick:L},{default:f(()=>[_(C(t.$t("下载模版")),1)]),_:1})])):g("",!0),y("div",z,[m(o,{drag:"","limit-size":r.limitSize,accept:r.accept,disabled:r.disabled,"auto-upload":!1,"before-upload":J,size:[220,"100%"]},null,8,["limit-size","accept","disabled"])])]))]),"slot-list":f(()=>[K.value.length?(u(),d("div",$,[y("div",A,[m(s,{type:"success",onClick:T},{default:f(()=>[_(C(t.$t("重新上传")),1)]),_:1}),m(s,{type:"danger",disabled:0==D.selection.length,onClick:i[0]||(i[0]=e=>D.del())},{default:f(()=>[_(C(t.$t("批量删除")),1)]),_:1},8,["disabled"])]),y("div",F,[m(n,{border:"",data:K.value,"max-height":"600px",onSelectionChange:D.onSelectionChange,onRowClick:i[1]||(i[1]=e=>{e._edit=!0})},{default:f(()=>[m(a,{type:"selection",width:"60px",align:"center",fixed:"left"}),m(a,{label:t.$t("序号"),type:"index",width:"80px",align:"center",fixed:"left",index:D.onIndex},null,8,["label","index"]),(u(!0),d(v,null,h(D.header,e=>(u(),j(a,{key:e,prop:e,label:e,"min-width":"160px",align:"center"},{default:f(t=>[t.row._edit?(u(),j(l,{key:1,modelValue:t.row[e],"onUpdate:modelValue":i=>t.row[e]=i,type:"textarea",clearable:"",placeholder:e},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(u(),d("span",B,C(t.row[e]),1))]),_:2},1032,["prop","label"]))),128)),m(a,{label:t.$t("操作"),width:"100px",align:"center",fixed:"right"},{default:f(i=>[m(s,{text:"",bg:"",type:"danger",onClick:e(e=>D.del(i.$index),["stop"])},{default:f(()=>[_(C(t.$t("删除")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data","onSelectionChange"])]),y("div",U,[m(p,{"current-page":R.page,"onUpdate:currentPage":i[2]||(i[2]=e=>R.page=e),background:"",layout:"total, prev, pager, next",total:P.list.length,"page-size":R.size,onCurrentChange:R.onCurrentChange},null,8,["current-page","total","page-size","onCurrentChange"])])])):g("",!0)]),_:1},512)],64)}}}),[["__scopeId","data-v-31e0cf9c"]]);export{q as default};
