import{l as e,w as a}from"./@vue_runtime-dom@3.5.18-D95plCo_.js";import{V as t}from"./vuedraggable@4.1.0_vue@3.5.18_typescript@5.5.4_-DM7RJheQ.js";import{h as s,_ as l,O as o}from"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import{d as i}from"./comm-D8jqGG-6.js";import{m as r,a as u,A as p,k as n,q as d,B as m,u as c,C as f}from"./index-D3YIdvZh.js";import{p as v,U as _,g as h,a as y}from"./index-aA9QvOjo.js";import{o as g,y as b,w as j,A as w,B as k}from"./lodash-es@4.17.21-DuLBTDIG.js";import{E as x}from"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import{u as z}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{C as U}from"./index-l1IOnGdE.js";import{d as S,v as B,w as P,A,c as C,o as F,a as q,P as V,N as R,F as D,m as M,O,M as T,R as I,Q as L,p as N}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{v as $,y as E}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import{P as K,p as G}from"./@vue_shared@3.5.18-BWKBh1Qo.js";import{_ as J}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./sortablejs@1.14.0-C-Ti-8jj.js";import"./chardet@2.1.0-B0E1a5C9.js";import"./vue@3.5.18_typescript@5.5.4-Bb9RU4DZ.js";import"./element-plus@2.10.4_vue@3.5.18_typescript@5.5.4_-BKZsM6nW.js";import"./dayjs@1.11.13-DxKHiy_y.js";import"./normalize-wheel-es@1.2.0-TzhA1irr.js";import"./@vueuse_core@9.13.0_vue@3.5.18_typescript@5.5.4_-CQVfZnDR.js";import"./@vueuse_shared@9.13.0_vue@3.5.18_typescript@5.5.4_-DyKSiD-b.js";import"./@ctrl_tinycolor@3.6.1-D2oWfImC.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-CyTP3PVf.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-B6jvMh_s.js";import"./store@2.0.12-BfN7CKDu.js";import"./mitt@3.0.1-BeZB7Ik_.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.18_typescript@5.5.4_-DPB-daMN.js";import"./vue-router@4.5.1_vue@3.5.18_typescript@5.5.4_-LCN95BWb.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.18_echarts@5.6.0_vue@3.5.18_typescript@5.5.4_-He2CYVXX.js";import"./echarts@5.6.0-D5a_RdwN.js";import"./tslib@2.3.0-ZseNXxlj.js";import"./zrender@5.6.1-BkMfNy7l.js";import"./axios@1.11.0-C-1G2k3o.js";import"./nprogress@0.2.0-Sg3Wh2FH.js";import"./@sxzz_popperjs-es@2.11.7-CT_jBSb5.js";import"./async-validator@4.2.5-j0i5Y79Y.js";import"./memoize-one@6.0.0-BAtLgO95.js";import"./@floating-ui_dom@1.7.2-CHufsicy.js";import"./@floating-ui_core@1.7.2-DWnBSKmT.js";import"./@floating-ui_utils@0.2.10-QZXVpxRV.js";import"./@intlify_core-base@11.1.10-C1bgUhoS.js";import"./@intlify_shared@11.1.10-BEv--mwN.js";import"./@intlify_message-compiler@11.1.10-JI08Nz38.js";const Q={key:0,class:"cl-upload__file-btn"},H={key:0,class:"cl-upload__footer"},W={key:0,class:"cl-upload__demo is-dragger"},X={key:1,class:"cl-upload__demo"},Y={key:0,class:"text"},Z={class:"cl-upload__item"},ee=S({name:"undefined"}),ae=J(S({...ee,name:"cl-upload",props:{...U,modelValue:{type:[String,Array],default:()=>[]},type:{type:String,default:"image"},accept:String,multiple:Boolean,limit:Number,limitSize:Number,autoUpload:{type:Boolean,default:!0},size:[String,Number,Array],small:Boolean,icon:null,text:String,showTag:{type:Boolean,default:!0},showFileList:{type:Boolean,default:!0},draggable:Boolean,drag:Boolean,disabled:Boolean,deletable:Boolean,customClass:String,beforeUpload:Function,prefixPath:String},emits:["update:modelValue","change","upload","success","error","progress"],setup(U,{expose:S,emit:J}){e(e=>({eb0f4742:pe.value[0],eb0f4704:pe.value[1]}));const ee=U,ae=J,{refs:te,setRefs:se}=c(),{user:le}=u(),oe=i(),{options:ie,toUpload:re}=function(){const{options:e}=r.get("upload"),{user:a}=u(),{t:t}=z();return{options:e,toUpload:async function(s,l={}){return new Promise((o,i)=>{(async()=>{const{prefixPath:r,onProgress:u}=g({},e,l),c=p("");try{const{mode:e,type:t}=await n.base.comm.uploadMode(),l="local"==e,p=d(s.name),f=m(s.name)+"_"+c+"."+p;let _=l?f:v(r,f);const h=async({host:e,preview:r,data:p})=>{const d=new FormData;d.append("key",_);for(const a in p)d.has(a)||d.append(a,p[a]);d.append("file",s);let m=0;const f={url:e,method:"POST",headers:{"Content-Type":"multipart/form-data",Authorization:l?a.token:null,language:null},timeout:6e5,data:d,onUploadProgress(e){m=e.total?Math.floor(e.loaded/e.total*100):0,null==u||u(m)},proxy:l};"minio"==t&&(f.headers["Content-Type"]=s.type,f.method="PUT",f.data=s),await n.request(f).then(a=>{100!=m&&(null==u||u(100)),_=encodeURIComponent(_);let t="";t=l?a:v(r||e,_),o({key:_,url:t,fileId:c})}).catch(e=>{x.error(e.message),i(e)})};l?h({host:"admin/base/comm/upload"}):n.base.comm.upload(["aws","minio"].includes(t)?{key:_}:{}).then(e=>{switch(t){case"cos":h({host:e.url,data:e.credentials});break;case"oss":h({host:e.host,preview:e.publicDomain,data:{OSSAccessKeyId:e.OSSAccessKeyId,policy:e.policy,signature:e.signature}});break;case"qiniu":h({host:e.uploadUrl,preview:e.publicDomain,data:{token:e.token}});break;case"aws":h({host:e.url,data:e.fields});break;default:h({host:e.url,preview:e.previewUrl})}}).catch(i)}catch(f){x.error(t("文件上传失败")),i(f)}})()})}}}(),{t:ue}=z(),pe=B(()=>{const e=ee.size||ie.size;return(b(e)?e:[e,e]).map(e=>j(e)?e+"px":e)}),ne=B(()=>ee.isDisabled||ee.disabled),de=ee.limit||ie.limit.upload,me=ee.limitSize||ie.limit.size,ce=B(()=>{if(void 0!==ee.text)return ee.text;switch(ee.type){case"file":return ue("选择文件");case"image":return ue("选择图片");default:return""}}),fe=B(()=>({Authorization:le.token})),ve=$([]),_e=B(()=>"file"!=ee.type||!!ee.showFileList&&!w(ve.value)),he=B(()=>ee.accept||("file"==ee.type?"":"image/*")),ye=B(()=>{const e=ve.value.length;return ee.multiple&&!ne.value?de-e>0:0==e});async function ge(e,a){function t(){const t={uid:e.uid,size:e.size,name:e.name,type:y(e.name),progress:ee.autoUpload?0:100,url:"",preload:"",error:""};if("image"==t.type&&e instanceof File&&(t.preload=window.webkitURL.createObjectURL(e)),ae("upload",t,e),a)k(a,t);else if(ee.multiple){if(!ye.value)return x.warning(ue("最多只能上传{n}个文件",{n:de})),!1;ve.value.push(t)}else ve.value=[t];return!0}if(e.size/1024/1024>=me)return x.error(ue("上传文件大小不能超过 {n}MB!",{n:me})),!1;if(ee.beforeUpload){let s=ee.beforeUpload(e,a,{next:t});return f(s)?s.then(t).catch(()=>null):s&&(s=t()),s}return t()}function be(e){ve.value.splice(e,1),xe()}function je(){ve.value=[]}async function we(e,a){if(a||(a=ve.value.find(a=>a.uid==e.file.uid)),!a)return!1;re(e.file,{prefixPath:ee.prefixPath,onProgress(e){a.progress=e,ae("progress",a)}}).then(e=>{k(a,e),ae("success",a),xe()}).catch(e=>{a.error=e.message,ae("error",a)})}function ke(){return ve.value.find(e=>!e.url)}function xe(){if(!ke()){const e=h(ve.value),a=ee.multiple?h(ve.value):e[0]||"";ae("update:modelValue",a),ae("change",a),N(()=>{var e,a;ee.prop&&(null==(e=oe.value)||e.validateField(ee.prop)),null==(a=te.upload)||a.clearFiles()})}}return P(()=>ee.modelValue,e=>{if(ke())return!1;const a=(b(e)?e:[e]).filter(Boolean);ve.value=a.map((e,a)=>{const t=ve.value[a]||{};return k({progress:100,uid:p()},t,{type:y(e),url:e,preload:t.url==e?t.preload:e})}).filter((e,a)=>!!ee.multiple||0==a)},{immediate:!0}),S({isAdd:ye,list:ve,check:ke,clear:je,remove:be,upload:function(e){var a;je(),null==(a=te.upload)||a.clearFiles(),N(()=>{var a,t;null==(a=te.upload)||a.handleStart(e),null==(t=te.upload)||t.submit()})}}),(e,i)=>{const r=A("el-button"),u=A("el-upload"),p=A("el-icon");return F(),C("div",{class:G(["cl-upload__wrap",[U.customClass]])},[q("div",{class:G(["cl-upload",[`cl-upload--${U.type}`,{"is-disabled":ne.value,"is-multiple":U.multiple,"is-small":U.small}]])},[U.drag?V("",!0):(F(),C(D,{key:0},["file"==U.type?(F(),C("div",Q,[M(u,{ref:E(se)("upload"),drag:U.drag,action:"",accept:he.value,"show-file-list":!1,"before-upload":ge,"http-request":we,headers:fe.value,multiple:U.multiple,disabled:ne.value},{default:O(()=>[T(e.$slots,"default",{},()=>[M(r,{type:"success"},{default:O(()=>[I(K(ce.value),1)]),_:1})],!0)]),_:3},8,["drag","accept","headers","multiple","disabled"])])):V("",!0)],64)),_e.value?(F(),R(E(t),{key:1,modelValue:ve.value,"onUpdate:modelValue":i[0]||(i[0]=e=>ve.value=e),class:"cl-upload__list",tag:"div","ghost-class":"Ghost","drag-class":"Drag","item-key":"uid",disabled:!U.draggable,onEnd:xe},{footer:O(()=>[("image"==U.type||U.drag)&&ye.value?(F(),C("div",H,[M(u,{ref:E(se)("upload"),action:"",drag:U.drag,accept:he.value,"show-file-list":!1,"before-upload":ge,"http-request":we,headers:fe.value,multiple:U.multiple,disabled:ne.value},{default:O(()=>[T(e.$slots,"default",{},()=>[U.drag?(F(),C("div",W,[M(p,{size:46},{default:O(()=>[M(E(l))]),_:1}),q("div",null,K(E(ue)("点击上传或将文件拖动到此处，文件大小限制{n}M",{n:E(me)})),1)])):(F(),C("div",X,[M(p,{size:36},{default:O(()=>[U.icon?(F(),R(L(U.icon),{key:0})):(F(),R(E(o),{key:1}))]),_:1}),ce.value?(F(),C("span",Y,K(ce.value),1)):V("",!0)]))],!0)]),_:3},8,["drag","accept","headers","multiple","disabled"])])):V("",!0)]),item:O(({element:t,index:l})=>[M(u,{action:"",accept:he.value,"show-file-list":!1,"http-request":e=>we(e,t),"before-upload":e=>{ge(e,t)},headers:fe.value,disabled:ne.value},{default:O(()=>[T(e.$slots,"item",{item:t,index:l},()=>[q("div",Z,[M(_,{"show-tag":U.showTag,item:t,list:ve.value,disabled:ne.value,deletable:U.deletable,onRemove:e=>be(l)},null,8,["show-tag","item","list","disabled","deletable","onRemove"]),U.small?(F(),R(p,{key:0,class:"cl-upload__item-remove",onClick:a(e=>be(l),["stop"])},{default:O(()=>[M(E(s))]),_:2},1032,["onClick"])):V("",!0)])],!0)]),_:2},1032,["accept","http-request","before-upload","headers","disabled"])]),_:3},8,["modelValue","disabled"])):V("",!0)],2)],2)}}}),[["__scopeId","data-v-8b1a6295"]]);export{ae as default};
