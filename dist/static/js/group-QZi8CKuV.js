import{l as e,v as s}from"./@vue_runtime-dom@3.5.18-D95plCo_.js";import{s as t}from"./@element-plus_icons-vue@2.3.1_vue@3.5.18_typescript@5.5.4_-3DUFfuWD.js";import{u as i,b as l,e as a}from"./index-D3YIdvZh.js";import{d as o,b as r}from"./comm-D8jqGG-6.js";import{B as n,A as c,o as u}from"./lodash-es@4.17.21-DuLBTDIG.js";import{E as p,a as d}from"./element-plus@2.10.2_vue@3.5.18_typescript@5.5.4_-C0B857f5.js";import{d as v,J as m,z as _,e as f,A as h,E as y,c as b,o as g,a as j,m as x,M as k,P as C,N as w,p as $,D as z,O as M,R as E,Q as D,F as S,a0 as A}from"./@vue_runtime-core@3.5.18-Bx_iA1Ob.js";import{u as K}from"./vue-i18n@11.1.10_vue@3.5.18_typescript@5.5.4_-CsgNkmMV.js";import{u as L,v as R,y as V}from"./@vue_reactivity@3.5.18-BEjiziYi.js";import{p as N,P as W}from"./@vue_shared@3.5.18-BWKBh1Qo.js";import{_ as F}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./@vueuse_core@12.8.2_typescript@5.5.4-CyTP3PVf.js";import"./@vueuse_shared@12.8.2_typescript@5.5.4-B6jvMh_s.js";import"./store@2.0.12-BfN7CKDu.js";import"./chardet@2.1.0-B0E1a5C9.js";import"./mitt@3.0.1-BeZB7Ik_.js";import"./pinia@2.3.1_typescript@5.5.4_vue@3.5.18_typescript@5.5.4_-DPB-daMN.js";import"./vue-router@4.5.1_vue@3.5.18_typescript@5.5.4_-LCN95BWb.js";import"./vue-echarts@7.0.3_@vue_runtime-core@3.5.18_echarts@5.6.0_vue@3.5.18_typescript@5.5.4_-He2CYVXX.js";import"./echarts@5.6.0-D5a_RdwN.js";import"./tslib@2.3.0-ZseNXxlj.js";import"./zrender@5.6.1-BkMfNy7l.js";import"./axios@1.11.0-C-1G2k3o.js";import"./nprogress@0.2.0-Sg3Wh2FH.js";import"./@vueuse_shared@9.13.0_vue@3.5.18_typescript@5.5.4_-DyKSiD-b.js";import"./@vueuse_core@9.13.0_vue@3.5.18_typescript@5.5.4_-CQVfZnDR.js";import"./@sxzz_popperjs-es@2.11.7-CT_jBSb5.js";import"./@ctrl_tinycolor@3.6.1-D2oWfImC.js";import"./dayjs@1.11.13-DxKHiy_y.js";import"./async-validator@4.2.5-j0i5Y79Y.js";import"./memoize-one@6.0.0-BAtLgO95.js";import"./normalize-wheel-es@1.2.0-TzhA1irr.js";import"./@floating-ui_dom@1.7.2-CHufsicy.js";import"./@floating-ui_core@1.7.2-DWnBSKmT.js";import"./@floating-ui_utils@0.2.10-QZXVpxRV.js";import"./element-plus@2.10.4_vue@3.5.18_typescript@5.5.4_-BKZsM6nW.js";import"./@intlify_core-base@11.1.10-C1bgUhoS.js";import"./@intlify_shared@11.1.10-BEv--mwN.js";import"./@intlify_message-compiler@11.1.10-JI08Nz38.js";const G={class:"cl-view-group__wrap"},J={class:"cl-view-group__left"},P={class:"scope"},q={class:"head"},B={key:0,class:"search"},I={class:"data"},O={class:"item"},Q=["infinite-scroll-disabled"],T=["onClick","onContextmenu"],U={class:"text-ellipsis overflow-hidden mr-2"},H={class:"cl-view-group__right"},X={class:"head"},Y={class:"title"},Z={class:"absolute right-[10px]"},ee={key:0,class:"content"},se=v({name:"undefined"}),te=F(v({...se,name:"cl-view-group",setup(v,{expose:F}){e(e=>({b3160d78:ne.leftWidth}));const{browser:se,onScreenChange:te}=l(),ie=m(),le=o(),{refs:ae,setRefs:oe}=i(),{t:re}=K(),ne=L(n({label:re("组"),title:re("列表"),leftWidth:"300px",data:{},service:{},enableContextMenu:!0,enableRefresh:!0,enableKeySearch:!0,enableAdd:!0,custom:!1},_("useViewGroup__options"))),ce=!!ie.left;c(ne.service);const ue=R(!1),pe=R(""),de=R([]),ve=R(!0),me=R(),_e=L(u({visible:!!ne.tree,props:{label:"name",children:"children",disabled:"disabled",isLeaf:"isLeaf",class:""},defaultExpandedKeys:[]},ne.tree));function fe(e){ve.value=void 0===e?!ve.value:e}function he(e){e||(e=de.value[0]),me.value=e,$(()=>{e&&(se.isMini&&fe(!1),ne.onSelect&&ne.onSelect(e))})}function ye(e){var s,t;null==(t=le.value)||t.open({title:re(e?"编辑":"添加")+ne.label,form:{...e},on:{submit(s,{close:t,done:i}){ne.service[e?"update":"add"](s).then(()=>{p.success(re("保存成功")),e&&n(e,s),xe(),t()}).catch(e=>{p.error(e.message),i()})}},...null==(s=ne.onEdit)?void 0:s.call(ne,e)})}function be(e){d.confirm(re("此操作将会删除选择的数据，是否继续？"),re("提示"),{type:"warning"}).then(()=>{function s(s){ne.service.delete(s).then(async()=>{var s;p.success(re("删除成功")),await xe(),(null==(s=me.value)?void 0:s.id)==e.id&&he()}).catch(e=>{p.error(e.message)})}ne.onDelete?ne.onDelete(e,{next:s}):s({ids:[e.id]})}).catch(()=>null)}const ge={order:"createTime",sort:"asc",page:1,size:50},je=R(!1);async function xe(e){if(ce)return!1;n(ge,e),ue.value=!0;const s={...ge,...ne.data,keyWord:pe.value};let t;t=_e.visible?ne.service.list(s).then(e=>{de.value=a(e)}):ne.service.page(s).then(e=>{var s;const t=(null==(s=ne.onData)?void 0:s.call(ne,e.list))||e.list;1==ge.page?de.value=t:de.value.push(...t),je.value=e.pagination.total<=de.value.length}),await t.then(()=>{const e=me.value||de.value[0];if(e){if(_e.visible){ae.tree.getNode(e).expand()}he(e)}}).catch(e=>{p.error(e.message)}),ue.value=!1}function ke(){xe({page:ge.page+1})}return te(()=>{fe(!se.isMini)}),f(()=>{xe()}),F({list:de,selected:me,isExpand:ve,expand:fe,select:he,browser:se,edit:ye,remove:be,refresh:xe}),(e,i)=>{const l=h("el-text"),a=h("cl-svg"),o=h("el-tooltip"),n=h("el-input"),u=h("el-tree"),p=h("el-empty"),d=h("el-scrollbar"),v=h("cl-form"),m=y("permission"),_=y("infinite-scroll"),f=y("loading");return g(),b("div",{class:N(["cl-view-group",[ve.value?"is-expand":"is-collapse"]])},[j("div",G,[j("div",J,[k(e.$slots,"left",{},()=>[j("div",P,[j("div",q,[x(l,{class:"label"},{default:M(()=>[E(W(ne.label),1)]),_:1}),ne.enableRefresh?(g(),w(o,{key:0,content:e.$t("刷新")},{default:M(()=>[j("div",{class:"icon",onClick:i[0]||(i[0]=e=>xe())},[x(a,{name:"refresh"})])]),_:1},8,["content"])):C("",!0),ne.enableAdd?(g(),w(o,{key:1,content:e.$t("添加")},{default:M(()=>[z((g(),b("div",{class:"icon",onClick:i[1]||(i[1]=e=>ye())},[x(a,{name:"plus-border"})])),[[m,ne.service.permission.add]])]),_:1},8,["content"])):C("",!0),k(e.$slots,"left-op",{},void 0,!0)]),ne.enableKeySearch?(g(),b("div",B,[x(n,{modelValue:pe.value,"onUpdate:modelValue":i[2]||(i[2]=e=>pe.value=e),placeholder:e.$t("搜索关键字"),clearable:"","prefix-icon":V(t),onChange:i[3]||(i[3]=e=>xe({page:1}))},null,8,["modelValue","placeholder","prefix-icon"])])):C("",!0),z((g(),b("div",I,[x(d,null,{default:M(()=>[_e.visible?(g(),w(u,{key:0,ref:V(oe)("tree"),class:"tree","highlight-current":"","auto-expand-parent":"","expand-on-click-node":!1,lazy:_e.lazy,data:de.value,props:_e.props,load:_e.onLoad,onNodeClick:he},{default:M(({data:s})=>[j("div",O,[s.icon?(g(),w(D(s.icon),{key:0})):C("",!0),k(e.$slots,"item-name",{item:s,selected:me.value},()=>[x(l,{truncated:""},{default:M(()=>{var e;return[E(W(s[_e.props.label])+" "+W(V(c)(s[_e.props.children])?"":`（${null==(e=s[_e.props.children])?void 0:e.length}）`),1)]}),_:2},1024)],!0)])]),_:3},8,["lazy","data","props","load"])):z((g(),b("ul",{key:1,class:"list","infinite-scroll-immediate":!1,"infinite-scroll-disabled":je.value},[(g(!0),b(S,null,A(de.value,(t,i)=>(g(),b("li",{key:i,onClick:e=>he(t),onContextmenu:e=>{!function(e,s){var t,i;if(!ne.enableContextMenu)return!1;r.open(e,{hover:{target:"item"},list:[{label:re("编辑"),hidden:!(null==(t=ne.service._permission)?void 0:t.update),callback(e){e(),ye(s)}},{label:re("删除"),hidden:!(null==(i=ne.service._permission)?void 0:i.delete),callback(e){e(),be(s)}}],...ne.onContextMenu&&ne.onContextMenu(s)})}(e,t)}},[k(e.$slots,"item",{item:t,selected:me.value,index:i},()=>{var l,o;return[j("div",{class:N(["item",{"is-active":(null==(l=me.value)?void 0:l.id)==t.id}])},[k(e.$slots,"item-name",{item:t,selected:me.value,index:i},()=>[j("span",U,W(t.name),1)],!0),z(x(a,{name:"right",class:"ml-auto"},null,512),[[s,(null==(o=me.value)?void 0:o.id)==t.id]])],2)]},!0)],40,T))),128)),0==de.value.length?(g(),w(p,{key:0,"image-size":80})):C("",!0)],8,Q)),[[_,ke]])]),_:3})])),[[f,ue.value]])])],!0),V(se).isMini?(g(),b("div",{key:0,class:"collapse-btn",onClick:i[4]||(i[4]=e=>fe(!1))},[x(a,{name:"right"})])):C("",!0)]),j("div",H,[j("div",X,[j("div",{class:N(["icon is-bg absolute left-[10px]",{"is-fold":!ve.value}]),onClick:i[5]||(i[5]=e=>fe())},[x(a,{name:"back"})],2),k(e.$slots,"title",{selected:me.value},()=>{var s;return[j("span",Y,W(ne.title)+"（"+W((null==(s=me.value)?void 0:s.name)||e.$t("未选择"))+"） ",1)]},!0),j("div",Z,[k(e.$slots,"right-op",{},void 0,!0)])]),me.value||ne.custom?(g(),b("div",ee,[k(e.$slots,"right",{},void 0,!0)])):(g(),w(p,{key:1,"image-size":80}))])]),x(v,{ref_key:"Form",ref:le},null,512)],2)}}}),[["__scopeId","data-v-0c095455"]]);export{te as default};
